<?xml version="1.0"?>
<DTS:Executable xmlns:DTS="www.microsoft.com/SqlServer/Dts"
  DTS:refId="Package"
  DTS:CreationDate="8/23/2016 2:19:29 PM"
  DTS:CreationName="Microsoft.Package"
  DTS:CreatorComputerName="W7PC01XQ1T"
  DTS:CreatorName="ANGLICARE-SA\jshen"
  DTS:DTSID="{6DB2316E-CE42-4B09-8609-FE52BF1A9A9D}"
  DTS:ExecutableType="Microsoft.Package"
  DTS:LastModifiedProductVersion="13.0.2164.0"
  DTS:LocaleID="3081"
  DTS:ObjectName="Conform_Fact - DEV"
  DTS:PackageType="5"
  DTS:ProtectionLevel="0"
  DTS:VersionBuild="660"
  DTS:VersionGUID="{C2365CAA-C239-4426-956C-0FE2E0C059F7}">
  <DTS:Property
    DTS:Name="PackageFormatVersion">8</DTS:Property>
  <DTS:ConnectionManagers>
    <DTS:ConnectionManager
      DTS:refId="Package.ConnectionManagers[devsql-1\whouse.DWHB.asadwh]"
      DTS:CreationName="OLEDB"
      DTS:DTSID="{BF90892F-2F5D-47CF-A2FA-4F3850A04535}"
      DTS:ObjectName="devsql-1\whouse.DWHB.asadwh">
      <DTS:ObjectData>
        <DTS:ConnectionManager
          DTS:ConnectionString="Data Source=devsql-1\whouse;Initial Catalog=DWHB;Provider=SQLNCLI11.1;Integrated Security=SSPI;Auto Translate=False;" />
      </DTS:ObjectData>
    </DTS:ConnectionManager>
    <DTS:ConnectionManager
      DTS:refId="Package.ConnectionManagers[devsql-1\whouse.DWHB.asadwh 1]"
      DTS:CreationName="OLEDB"
      DTS:DTSID="{6B844CC6-0F5A-4327-899C-E5FE6584670F}"
      DTS:ObjectName="devsql-1\whouse.DWHB.asadwh 1">
      <DTS:ObjectData>
        <DTS:ConnectionManager
          DTS:ConnectionString="Data Source=devsql-1\whouse;Initial Catalog=DWHB;Provider=SQLNCLI11.1;Integrated Security=SSPI;Auto Translate=False;" />
      </DTS:ObjectData>
    </DTS:ConnectionManager>
  </DTS:ConnectionManagers>
  <DTS:Variables>
    <DTS:Variable
      DTS:CreationName=""
      DTS:DTSID="{CC74842B-34A0-4B10-A6AD-BC23AD8039AD}"
      DTS:IncludeInDebugDump="6789"
      DTS:Namespace="User"
      DTS:ObjectName="anniversary_date_key">
      <DTS:VariableValue
        DTS:DataType="3">9999999</DTS:VariableValue>
    </DTS:Variable>
    <DTS:Variable
      DTS:CreationName=""
      DTS:DTSID="{8C96DFF2-D4F0-4A0B-8E56-96B6C6E96DF5}"
      DTS:IncludeInDebugDump="2345"
      DTS:Namespace="User"
      DTS:ObjectName="change_reason_code_new">
      <DTS:VariableValue
        DTS:DataType="8">N</DTS:VariableValue>
    </DTS:Variable>
    <DTS:Variable
      DTS:CreationName=""
      DTS:DTSID="{367595F9-7886-4944-964F-93BCD4C4D23D}"
      DTS:IncludeInDebugDump="2345"
      DTS:Namespace="User"
      DTS:ObjectName="change_reason_code_update">
      <DTS:VariableValue
        DTS:DataType="8">U</DTS:VariableValue>
    </DTS:Variable>
    <DTS:Variable
      DTS:CreationName=""
      DTS:DTSID="{F0942BB2-A557-42EB-A246-E2647CC06B8E}"
      DTS:IncludeInDebugDump="2345"
      DTS:Namespace="User"
      DTS:ObjectName="change_reason_description_new">
      <DTS:VariableValue
        DTS:DataType="8">NEW</DTS:VariableValue>
    </DTS:Variable>
    <DTS:Variable
      DTS:CreationName=""
      DTS:DTSID="{5F963C1F-DFC6-4C14-B462-56654CF8E014}"
      DTS:IncludeInDebugDump="2345"
      DTS:Namespace="User"
      DTS:ObjectName="change_reason_description_update">
      <DTS:VariableValue
        DTS:DataType="8">UPDATE</DTS:VariableValue>
    </DTS:Variable>
    <DTS:Variable
      DTS:CreationName=""
      DTS:DTSID="{A3BF0FB3-A228-476E-82F5-BCF184AF55C2}"
      DTS:IncludeInDebugDump="2345"
      DTS:Namespace="User"
      DTS:ObjectName="current_row_indicator">
      <DTS:VariableValue
        DTS:DataType="8">Y</DTS:VariableValue>
    </DTS:Variable>
    <DTS:Variable
      DTS:CreationName=""
      DTS:DTSID="{85397108-740B-48F7-8217-B9643EA7C126}"
      DTS:EvaluateAsExpression="True"
      DTS:Expression="GETDATE()"
      DTS:IncludeInDebugDump="2345"
      DTS:Namespace="User"
      DTS:ObjectName="etl_start_date">
      <DTS:VariableValue
        DTS:DataType="7">8/23/2017 10:27:43 AM</DTS:VariableValue>
    </DTS:Variable>
    <DTS:Variable
      DTS:CreationName=""
      DTS:DTSID="{F0E172DC-A7CB-4EE0-9578-EA330BB74667}"
      DTS:IncludeInDebugDump="6789"
      DTS:Namespace="User"
      DTS:ObjectName="manager_pos_key">
      <DTS:VariableValue
        DTS:DataType="3">1694</DTS:VariableValue>
    </DTS:Variable>
    <DTS:Variable
      DTS:CreationName=""
      DTS:DTSID="{CCAE94E7-7B0B-4DAB-BC21-2DE23D965D34}"
      DTS:IncludeInDebugDump="6789"
      DTS:Namespace="User"
      DTS:ObjectName="manger_key">
      <DTS:VariableValue
        DTS:DataType="3">1780</DTS:VariableValue>
    </DTS:Variable>
    <DTS:Variable
      DTS:CreationName=""
      DTS:DTSID="{E92992E9-5DD3-42B9-BC33-2E531B0B5145}"
      DTS:IncludeInDebugDump="2345"
      DTS:Namespace="User"
      DTS:ObjectName="new_position_flag">
      <DTS:VariableValue
        DTS:DataType="8">Y</DTS:VariableValue>
    </DTS:Variable>
    <DTS:Variable
      DTS:CreationName=""
      DTS:DTSID="{4C1D89BD-73AE-4455-A1D1-F466789D712E}"
      DTS:IncludeInDebugDump="6789"
      DTS:Namespace="User"
      DTS:ObjectName="position_vacant_date_key">
      <DTS:VariableValue
        DTS:DataType="3">9999999</DTS:VariableValue>
    </DTS:Variable>
    <DTS:Variable
      DTS:CreationName=""
      DTS:DTSID="{1BA5A3E8-2B2C-45E5-B1DD-DF02E7543A84}"
      DTS:EvaluateAsExpression="True"
      DTS:Expression="GETDATE()"
      DTS:IncludeInDebugDump="2345"
      DTS:Namespace="User"
      DTS:ObjectName="row_effective_date">
      <DTS:VariableValue
        DTS:DataType="7">8/23/2017 10:27:43 AM</DTS:VariableValue>
    </DTS:Variable>
    <DTS:Variable
      DTS:CreationName=""
      DTS:DTSID="{3CC1B8BD-D845-4EBA-B055-DC77257F0D23}"
      DTS:EvaluateAsExpression="True"
      DTS:Expression="GETDATE()"
      DTS:IncludeInDebugDump="2345"
      DTS:Namespace="User"
      DTS:ObjectName="row_expiration_date">
      <DTS:VariableValue
        DTS:DataType="7">8/23/2017 10:27:43 AM</DTS:VariableValue>
    </DTS:Variable>
    <DTS:Variable
      DTS:CreationName=""
      DTS:DTSID="{562512CA-AE66-4665-B126-F47B8CD33899}"
      DTS:IncludeInDebugDump="2345"
      DTS:Namespace="User"
      DTS:ObjectName="survery_completed">
      <DTS:VariableValue
        DTS:DataType="8">NO</DTS:VariableValue>
    </DTS:Variable>
  </DTS:Variables>
  <DTS:Executables>
    <DTS:Executable
      DTS:refId="Package\Sequence Container - Fact Tables"
      DTS:CreationName="STOCK:SEQUENCE"
      DTS:Description="Sequence Container"
      DTS:DTSID="{EC7FBD86-B585-42D4-96AB-F010995189E8}"
      DTS:ExecutableType="STOCK:SEQUENCE"
      DTS:LocaleID="-1"
      DTS:ObjectName="Sequence Container - Fact Tables">
      <DTS:Variables />
      <DTS:Executables>
        <DTS:Executable
          DTS:refId="Package\Sequence Container - Fact Tables\SD1 - DEBTOR_FACT"
          DTS:CreationName="STOCK:SEQUENCE"
          DTS:Description="Sequence Container"
          DTS:DTSID="{8EA6259A-8927-4D20-95F1-D4A36ABB04BC}"
          DTS:ExecutableType="STOCK:SEQUENCE"
          DTS:LocaleID="-1"
          DTS:ObjectName="SD1 - DEBTOR_FACT">
          <DTS:Variables />
          <DTS:Executables>
            <DTS:Executable
              DTS:refId="Package\Sequence Container - Fact Tables\SD1 - DEBTOR_FACT\EST - Write Job Finish info"
              DTS:CreationName="Microsoft.ExecuteSQLTask"
              DTS:Description="Execute SQL Task"
              DTS:DTSID="{E278CD8B-392F-42AC-8C06-7F5826D06B45}"
              DTS:ExecutableType="Microsoft.ExecuteSQLTask"
              DTS:LocaleID="-1"
              DTS:ObjectName="EST - Write Job Finish info"
              DTS:TaskContact="Execute SQL Task; Microsoft Corporation; SQL Server 2016; © 2015 Microsoft Corporation; All Rights Reserved;http://www.microsoft.com/sql/support/default.asp;1"
              DTS:ThreadHint="0">
              <DTS:Variables />
              <DTS:ObjectData>
                <SQLTask:SqlTaskData
                  SQLTask:Connection="{6B844CC6-0F5A-4327-899C-E5FE6584670F}"
                  SQLTask:SqlStatementSource="INSERT INTO [management].ETL_PROCESS_FACT&#xA;SELECT  &#xA;(SELECT DATE_KEY FROM management.DATE_DIM WHERE CONVERT(DATE,FULL_DATE)=CONVERT(DATE,GETDATE()) )&#xA;,(SELECT batch_key FROM management.BATCH_DIM WHERE BATCH_TYPE='batch')&#xA;, T2.TABLE_KEY&#xA;,2&#xA;,GETDATE() ,&#xA;4,&#xA;'Finish updating FACT table'&#xA;FROM  management.TABLE_DIM T2&#xA;WHERE T2.[SCHEMA]+'.'+T2.TABLE_NAME='conform_finance.debtor_fact'&#xA;" xmlns:SQLTask="www.microsoft.com/sqlserver/dts/tasks/sqltask" />
              </DTS:ObjectData>
            </DTS:Executable>
            <DTS:Executable
              DTS:refId="Package\Sequence Container - Fact Tables\SD1 - DEBTOR_FACT\EST - Write Job Start info"
              DTS:CreationName="Microsoft.ExecuteSQLTask"
              DTS:Description="Execute SQL Task"
              DTS:DTSID="{849B4079-7551-42BE-8A69-5047EF668F59}"
              DTS:ExecutableType="Microsoft.ExecuteSQLTask"
              DTS:LocaleID="-1"
              DTS:ObjectName="EST - Write Job Start info"
              DTS:TaskContact="Execute SQL Task; Microsoft Corporation; SQL Server 2016; © 2015 Microsoft Corporation; All Rights Reserved;http://www.microsoft.com/sql/support/default.asp;1"
              DTS:ThreadHint="0">
              <DTS:Variables />
              <DTS:ObjectData>
                <SQLTask:SqlTaskData
                  SQLTask:Connection="{6B844CC6-0F5A-4327-899C-E5FE6584670F}"
                  SQLTask:SqlStatementSource="INSERT INTO [management].ETL_PROCESS_FACT&#xA;SELECT  &#xA;(SELECT DATE_KEY FROM management.DATE_DIM WHERE CONVERT(DATE,FULL_DATE)=CONVERT(DATE,GETDATE()) )&#xA;,(SELECT batch_key FROM management.BATCH_DIM WHERE BATCH_TYPE='batch')&#xA;, T2.TABLE_KEY&#xA;,1&#xA;,GETDATE() ,&#xA;4,&#xA;'Start to update FACT table'&#xA;FROM  management.TABLE_DIM T2&#xA;WHERE T2.[SCHEMA]+'.'+T2.TABLE_NAME='conform_finance.debtor_fact'&#xA;&#xA;" xmlns:SQLTask="www.microsoft.com/sqlserver/dts/tasks/sqltask" />
              </DTS:ObjectData>
            </DTS:Executable>
            <DTS:Executable
              DTS:refId="Package\Sequence Container - Fact Tables\SD1 - DEBTOR_FACT\Get new records and update columns"
              DTS:CreationName="Microsoft.ExecuteSQLTask"
              DTS:Description="Execute SQL Task"
              DTS:DTSID="{7F3C4961-1708-4AC1-96B3-765A08A91CA8}"
              DTS:ExecutableType="Microsoft.ExecuteSQLTask"
              DTS:LocaleID="-1"
              DTS:ObjectName="Get new records and update columns"
              DTS:ThreadHint="0">
              <DTS:Variables />
              <DTS:ObjectData>
                <SQLTask:SqlTaskData
                  SQLTask:Connection="{6B844CC6-0F5A-4327-899C-E5FE6584670F}"
                  SQLTask:SqlStatementSource="   --temp table &#xA;   declare @debtorglmap TABLE&#xA;   (&#xA;   ldg_name varchar(20),&#xA;   accnbri varchar(20),&#xA;   doc_ref1 varchar(20),&#xA;   amt1 decimal(14,2),&#xA;   cost_ldg_name varchar(20),&#xA;   cost_accnbri varchar(20),&#xA;   cost_amt1 decimal(14,2),&#xA;   cost_centre_key int&#x9;   &#xA;   ) ;&#xA;&#xA;   insert into &#x9;@debtorglmap&#xA;     select &#xA;    r1.*,&#xA;&#x9;cost.ldg_name as cost_ldg_name,&#xA;&#x9;cost.ACCNBRI as cost_accnbri&#x9;,&#xA;&#x9;cost.AMT1 as cost_amt1 &#x9;,&#xA;&#x9;isnull(d1.cost_centre_key,&#x9;  (select cost_centre_key from conform_finance.cost_centre_dim where  ldg_name='No Cost' and current_row_indicator='Y' ) )&#xA;&#x9; &#xA;  from &#xA;  (&#xA;    select ldg_name,ACCNBRI,doc_ref1,amt1 &#xA;   from  extract.glf_ldg_acc_trans&#xA;   where ldg_name='R1'  and  len(doc_ref1)&gt;0&#xA;   ) as r1&#xA;   inner join&#xA;   (&#xA;   select ldg_name,ACCNBRI,doc_ref1,amt1 &#xA;   from  extract.glf_ldg_acc_trans&#xA;   where ldg_name like '%ACT' and len(ACCNBRI)=15 and  len(doc_ref1)&gt;0&#xA;   ) as cost&#xA;   on r1.DOC_REF1=cost.DOC_REF1&#x9;     and abs(r1.AMT1)=abs(cost.AMT1)&#xA;   left join conform_finance.cost_centre_dim as d1 on cost.ldg_name=d1.ldg_name and cost.ACCNBRI= d1.accnbri&#x9;and d1.current_row_indicator='Y'&#xA;&#xA;&#xA;    select ldg_name,ACCNBRI,doc_ref1,amt1 &#xA;   from  extract.glf_ldg_acc_trans&#xA;   where ldg_name='R1'  and  len(doc_ref1)&gt;0&#xA;&#xA;&#xA;  insert into conform_finance.debtor_fact&#xA;  select &#xA;  d1.account_key,&#xA;   isnull(f1.cost_centre_key, (select cost_centre_key from conform_finance.cost_centre_dim where  ldg_name='No Cost' and current_row_indicator='Y' ) ),&#xA;  (select portfolio_key from conform_finance.portfolio_dim where portfolio_name like 'No Portfolio%' and &#x9;   current_row_indicator='Y' ),&#xA;  (select service_stream_key from conform_finance.service_stream_dim where service_stream_name like 'No Service%' and &#x9;   current_row_indicator='Y' ),&#xA;  (select program_key from conform_finance.program_dim where program_name like 'No Prog%' and &#x9;   current_row_indicator='Y' ),&#xA;  ISNULL(d5.accounting_period_key,(select accounting_period_key from conform_finance.accounting_period_dim  where fiscal_year like 'No Period%' and current_row_indicator='Y' )&#x9;) ,&#xA;  d2.date_key,&#xA;  d3.date_key,&#xA;  d4.ledger_key,&#xA;  t1.DOC_REF1,&#xA;  t1.AMT1  ,&#xA;  t1.DUE_DATEI,&#xA;  t1.NARR1,&#xA;  t1.NARR2,&#xA;  t1.NARR3,&#xA; t1.doc_type,&#xA;  case &#x9;&#xA;  when DUE_DATEI &lt;&gt; '1900-01-01 00:00:00.000'  then   Datediff(day,t1.due_datei,getdate())&#xA;  else 0&#xA;  end,&#xA;t1.alloc_amt1,&#xA;0&#xA;  from extract.glf_ldg_acc_trans   as t1&#xA;  inner join conform_finance.account_dim as d1 on t1.ACCNBRI=d1.account_number and d1.chart_name='ARCHART' and d1.current_row_indicator='Y'&#xA;  inner join conform_finance.date_dim as d2 on t1.DOC_DATEI1=d2.full_date&#xA;  inner join conform_finance.date_dim as d3 on t1.PDATEI=d3.full_date&#xA;  inner join conform_finance.ledger_dim as d4 on t1.ldg_name =d4.name and d4.current_row_indicator='Y'&#xA;  left join conform_finance.accounting_period_dim as d5 on t1.PERIOD=d5.period_no and convert(date,t1.DOC_DATEI1)=convert(date,d5.full_date)&#xA;  left join&#x9; @debtorglmap as f1 on t1.ACCNBRI=f1.ACCNBRI and t1.DOC_REF1=f1.DOC_REF1  &#xA;  where t1.ldg_name ='R1'&#xA;&#xA;&#xA;update conform_finance.debtor_fact&#xA;set outstanding_amt = alloc_amt1- amount&#xA;where doc_type ='ARINV';&#xA;&#xA;-----------------------------------------------------update org_structure-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------&#xA;--Step1: based on program_key.&#xA;--update program_key&#xA;&#xA;  update t1&#xA;  set &#x9;t1.program_key=t3.program_key&#xA;  from conform_finance.debtor_fact as t1&#xA;  inner join   conform_finance.account_dim as d1 on t1.account_key=d1.account_key and d1.chart_name='ARCHART' and d1.current_row_indicator='Y'&#xA;  inner join    extract.GLF_CHART_ACCT as t2 on d1.account_number=t2.ACCNBRI and t2.CHART_NAME='ARCHART'&#xA;  inner join conform_finance.program_mapping as t3 on t2.SELN_TYPE2_CODE = t3.value1 and t3.program_key is not null&#xA;&#xA;&#xA;--update service_stream and porfolio_key&#xA;&#xA;    update f1&#xA;  set &#x9;f1.service_stream_key=d2.service_stream_key&#x9;,&#xA;        f1.portfolio_key=d3.portfolio_key&#xA;  from conform_finance.debtor_fact as f1&#xA;  inner join conform_finance.program_dim as d1 on f1.program_key=d1.program_key and d1.current_row_indicator='Y' and f1.program_key&lt;&gt; (select program_key from conform_finance.program_dim where program_name like 'No Prog%' and &#x9;   current_row_indicator='Y')&#xA;  inner join &#xA;    ( --get all org based on names&#xA;&#x9;&#x9;select distinct t1.program_code,t1.service_stream_code,t2.portfolio_code , d1.program_name  ,d2.service_stream_name ,d3.portfolio_name ,d1.program_key,d2.service_stream_key,d3.portfolio_key&#xA;&#x9;&#x9;from conform.program_temp  as t1&#xA;&#x9;&#x9;inner join conform.service_stream_temp as t2   on t1.service_stream_code=t2.service_stream_code&#xA;&#x9;&#x9;inner join conform.program_dim as d1 on t1.program_code=d1.program_code and d1.current_row_indicator='Y'&#xA;&#x9;&#x9;inner join conform.service_stream_dim as d2 on t1.service_stream_code=d2.service_stream_code and d1.current_row_indicator='Y'&#xA;&#x9;&#x9;inner join conform.portfolio_dim as d3 on t2.portfolio_code=d3.portfolio_code and d1.current_row_indicator='Y'&#xA;    )&#x9;as f2&#xA;&#x9;on d1.program_name=f2.program_name&#xA;&#x9;inner join conform_finance.service_stream_dim as d2 on f2.service_stream_name=d2.service_stream_name   and d2.current_row_indicator='Y'&#xA;&#x9;inner join conform_finance.portfolio_dim as d3 on f2.portfolio_name=d3.portfolio_name and d3.current_row_indicator='Y'&#xA;&#xA;&#xA;" xmlns:SQLTask="www.microsoft.com/sqlserver/dts/tasks/sqltask" />
              </DTS:ObjectData>
            </DTS:Executable>
            <DTS:Executable
              DTS:refId="Package\Sequence Container - Fact Tables\SD1 - DEBTOR_FACT\Truncate table"
              DTS:CreationName="Microsoft.ExecuteSQLTask"
              DTS:Description="Execute SQL Task"
              DTS:DTSID="{5AB5ABB7-9067-4D4B-87C4-0144D581E923}"
              DTS:ExecutableType="Microsoft.ExecuteSQLTask"
              DTS:LocaleID="-1"
              DTS:ObjectName="Truncate table"
              DTS:ThreadHint="0">
              <DTS:Variables />
              <DTS:ObjectData>
                <SQLTask:SqlTaskData
                  SQLTask:Connection="{6B844CC6-0F5A-4327-899C-E5FE6584670F}"
                  SQLTask:SqlStatementSource="truncate table  conform_finance.debtor_fact" xmlns:SQLTask="www.microsoft.com/sqlserver/dts/tasks/sqltask" />
              </DTS:ObjectData>
            </DTS:Executable>
          </DTS:Executables>
          <DTS:PrecedenceConstraints>
            <DTS:PrecedenceConstraint
              DTS:refId="Package\Sequence Container - Fact Tables\SD1 - DEBTOR_FACT.PrecedenceConstraints[Constraint]"
              DTS:CreationName=""
              DTS:DTSID="{81819812-CD0E-4548-9F35-BF7124F756C0}"
              DTS:From="Package\Sequence Container - Fact Tables\SD1 - DEBTOR_FACT\EST - Write Job Start info"
              DTS:LogicalAnd="True"
              DTS:ObjectName="Constraint"
              DTS:To="Package\Sequence Container - Fact Tables\SD1 - DEBTOR_FACT\Truncate table" />
            <DTS:PrecedenceConstraint
              DTS:refId="Package\Sequence Container - Fact Tables\SD1 - DEBTOR_FACT.PrecedenceConstraints[Constraint 1]"
              DTS:CreationName=""
              DTS:DTSID="{2B28722D-0B49-4504-A642-E50630A8F1DC}"
              DTS:From="Package\Sequence Container - Fact Tables\SD1 - DEBTOR_FACT\Truncate table"
              DTS:LogicalAnd="True"
              DTS:ObjectName="Constraint 1"
              DTS:To="Package\Sequence Container - Fact Tables\SD1 - DEBTOR_FACT\Get new records and update columns" />
            <DTS:PrecedenceConstraint
              DTS:refId="Package\Sequence Container - Fact Tables\SD1 - DEBTOR_FACT.PrecedenceConstraints[Constraint 2]"
              DTS:CreationName=""
              DTS:DTSID="{0BF07C75-3E87-4477-B54D-C8EB4B3625C8}"
              DTS:From="Package\Sequence Container - Fact Tables\SD1 - DEBTOR_FACT\Get new records and update columns"
              DTS:LogicalAnd="True"
              DTS:ObjectName="Constraint 2"
              DTS:To="Package\Sequence Container - Fact Tables\SD1 - DEBTOR_FACT\EST - Write Job Finish info" />
          </DTS:PrecedenceConstraints>
          <DTS:EventHandlers>
            <DTS:EventHandler
              DTS:refId="Package\Sequence Container - Fact Tables\SD1 - DEBTOR_FACT.EventHandlers[OnError]"
              DTS:CreationName="OnError"
              DTS:DTSID="{8868727B-4220-46B2-BC7B-41448AA244A0}"
              DTS:EventID="244"
              DTS:EventName="OnError"
              DTS:LocaleID="-1">
              <DTS:Variables>
                <DTS:Variable
                  DTS:CreationName=""
                  DTS:Description="The propagate property of the event"
                  DTS:DTSID="{84240020-6C38-4484-B7F3-35216A964D7F}"
                  DTS:IncludeInDebugDump="6789"
                  DTS:Namespace="System"
                  DTS:ObjectName="Propagate">
                  <DTS:VariableValue
                    DTS:DataType="11">-1</DTS:VariableValue>
                </DTS:Variable>
              </DTS:Variables>
              <DTS:Executables>
                <DTS:Executable
                  DTS:refId="Package\Sequence Container - Fact Tables\SD1 - DEBTOR_FACT.EventHandlers[OnError]\Execute SQL Task - Catch Error Details"
                  DTS:CreationName="Microsoft.ExecuteSQLTask"
                  DTS:Description="Execute SQL Task"
                  DTS:DTSID="{4982DC4A-388C-4508-8541-61BB3B4DB4F7}"
                  DTS:ExecutableType="Microsoft.ExecuteSQLTask"
                  DTS:LocaleID="-1"
                  DTS:ObjectName="Execute SQL Task - Catch Error Details">
                  <DTS:Variables />
                  <DTS:ObjectData>
                    <SQLTask:SqlTaskData
                      SQLTask:Connection="{6B844CC6-0F5A-4327-899C-E5FE6584670F}"
                      SQLTask:SqlStatementSource="-- insert into management.ERROR_EVENT_DETAIL_FACT table&#xA;&#xA;insert into management.ERROR_EVENT_DETAIL_FACT&#xA;SELECT &#xA;(SELECT DATE_KEY FROM management.DATE_DIM WHERE CONVERT(DATE,FULL_DATE)=CONVERT(DATE,GETDATE()) )&#xA;,(SELECT batch_key FROM management.BATCH_DIM WHERE BATCH_TYPE='batch') &#xA;,T2.TABLE_KEY&#xA;,T2.TABLE_KEY&#xA;,?&#xA;,' '&#xA;,4&#xA;FROM  management.TABLE_DIM T2&#xA;WHERE T2.[SCHEMA]+'.'+T2.TABLE_NAME='conform.employee_termination_fact'&#xA;&#xA;&#xA;-- insert into [management].ETL_PROCESS_FACT with 'Failed'&#xA;INSERT INTO [management].ETL_PROCESS_FACT&#xA;SELECT  &#xA;(SELECT DATE_KEY FROM management.DATE_DIM WHERE CONVERT(DATE,FULL_DATE)=CONVERT(DATE,GETDATE()) )&#xA;,(SELECT batch_key FROM management.BATCH_DIM WHERE BATCH_TYPE='batch')&#xA;, T2.TABLE_KEY&#xA;,3&#xA;,GETDATE() &#xA;,4&#xA;,'Update Fact Table'    &#xA;FROM  management.TABLE_DIM T2&#xA;WHERE T2.[SCHEMA]+'.'+T2.TABLE_NAME='conform.employee_termination_fact'&#xA;&#xA; -- insert into management.ERROR_EVENT_FACT table&#xA;insert into management.ERROR_EVENT_FACT&#xA;SELECT &#xA;(SELECT batch_key FROM management.BATCH_DIM WHERE BATCH_TYPE='batch') &#xA;,(SELECT DATE_KEY FROM management.DATE_DIM WHERE CONVERT(DATE,FULL_DATE)=CONVERT(DATE,GETDATE()) )&#xA;,convert(varchar, getdate(),21)&#xA;, 'HIGH'&#xA;,4&#xA;FROM  management.TABLE_DIM T2&#xA;WHERE T2.[SCHEMA]+'.'+T2.TABLE_NAME='conform.employee_termination_fact'&#xA;&#xA;" xmlns:SQLTask="www.microsoft.com/sqlserver/dts/tasks/sqltask">
                      <SQLTask:ParameterBinding
                        SQLTask:ParameterName="0"
                        SQLTask:DtsVariableName="System::ErrorDescription"
                        SQLTask:ParameterDirection="Input"
                        SQLTask:DataType="130"
                        SQLTask:ParameterSize="-1" />
                    </SQLTask:SqlTaskData>
                  </DTS:ObjectData>
                </DTS:Executable>
              </DTS:Executables>
            </DTS:EventHandler>
          </DTS:EventHandlers>
        </DTS:Executable>
        <DTS:Executable
          DTS:refId="Package\Sequence Container - Fact Tables\SD1 - KPI_FACT"
          DTS:CreationName="STOCK:SEQUENCE"
          DTS:Description="Sequence Container"
          DTS:DTSID="{ec48c605-7a18-4196-bc76-9121bfd136b9}"
          DTS:ExecutableType="STOCK:SEQUENCE"
          DTS:LocaleID="-1"
          DTS:ObjectName="SD1 - KPI_FACT">
          <DTS:Variables />
          <DTS:Executables>
            <DTS:Executable
              DTS:refId="Package\Sequence Container - Fact Tables\SD1 - KPI_FACT\EST - Write Job Finish info"
              DTS:CreationName="Microsoft.ExecuteSQLTask"
              DTS:Description="Execute SQL Task"
              DTS:DTSID="{cdd1d7e4-1e5b-4baa-bb2a-f9e022e1d0d7}"
              DTS:ExecutableType="Microsoft.ExecuteSQLTask"
              DTS:LocaleID="-1"
              DTS:ObjectName="EST - Write Job Finish info"
              DTS:TaskContact="Execute SQL Task; Microsoft Corporation; SQL Server 2016; © 2015 Microsoft Corporation; All Rights Reserved;http://www.microsoft.com/sql/support/default.asp;1"
              DTS:ThreadHint="0">
              <DTS:Variables />
              <DTS:ObjectData>
                <SQLTask:SqlTaskData
                  SQLTask:Connection="{6B844CC6-0F5A-4327-899C-E5FE6584670F}"
                  SQLTask:SqlStatementSource="INSERT INTO [management].ETL_PROCESS_FACT&#xA;SELECT  &#xA;(SELECT DATE_KEY FROM management.DATE_DIM WHERE CONVERT(DATE,FULL_DATE)=CONVERT(DATE,GETDATE()) )&#xA;,(SELECT batch_key FROM management.BATCH_DIM WHERE BATCH_TYPE='batch')&#xA;, T2.TABLE_KEY&#xA;,2&#xA;,GETDATE() ,&#xA;4,&#xA;'Finish updating FACT table'&#xA;FROM  management.TABLE_DIM T2&#xA;WHERE T2.[SCHEMA]+'.'+T2.TABLE_NAME='conform_finance.KPI_fact'&#xA;" xmlns:SQLTask="www.microsoft.com/sqlserver/dts/tasks/sqltask" />
              </DTS:ObjectData>
            </DTS:Executable>
            <DTS:Executable
              DTS:refId="Package\Sequence Container - Fact Tables\SD1 - KPI_FACT\EST - Write Job Start info"
              DTS:CreationName="Microsoft.ExecuteSQLTask"
              DTS:Description="Execute SQL Task"
              DTS:DTSID="{0a182037-dd04-45d3-b37e-6695d4d75b91}"
              DTS:ExecutableType="Microsoft.ExecuteSQLTask"
              DTS:LocaleID="-1"
              DTS:ObjectName="EST - Write Job Start info"
              DTS:TaskContact="Execute SQL Task; Microsoft Corporation; SQL Server 2016; © 2015 Microsoft Corporation; All Rights Reserved;http://www.microsoft.com/sql/support/default.asp;1"
              DTS:ThreadHint="0">
              <DTS:Variables />
              <DTS:ObjectData>
                <SQLTask:SqlTaskData
                  SQLTask:Connection="{6B844CC6-0F5A-4327-899C-E5FE6584670F}"
                  SQLTask:SqlStatementSource="INSERT INTO [management].ETL_PROCESS_FACT&#xA;SELECT  &#xA;(SELECT DATE_KEY FROM management.DATE_DIM WHERE CONVERT(DATE,FULL_DATE)=CONVERT(DATE,GETDATE()) )&#xA;,(SELECT batch_key FROM management.BATCH_DIM WHERE BATCH_TYPE='batch')&#xA;, T2.TABLE_KEY&#xA;,1&#xA;,GETDATE() ,&#xA;4,&#xA;'Start to update FACT table'&#xA;FROM  management.TABLE_DIM T2&#xA;WHERE T2.[SCHEMA]+'.'+T2.TABLE_NAME='conform_finance.KPI_FACT'&#xA;" xmlns:SQLTask="www.microsoft.com/sqlserver/dts/tasks/sqltask" />
              </DTS:ObjectData>
            </DTS:Executable>
            <DTS:Executable
              DTS:refId="Package\Sequence Container - Fact Tables\SD1 - KPI_FACT\Get new records and update columns"
              DTS:CreationName="Microsoft.ExecuteSQLTask"
              DTS:Description="Execute SQL Task"
              DTS:DTSID="{4de82e98-e6b9-44ea-99ea-fc55c38d8173}"
              DTS:ExecutableType="Microsoft.ExecuteSQLTask"
              DTS:LocaleID="-1"
              DTS:ObjectName="Get new records and update columns"
              DTS:ThreadHint="0">
              <DTS:Variables />
              <DTS:ObjectData>
                <SQLTask:SqlTaskData
                  SQLTask:Connection="{6B844CC6-0F5A-4327-899C-E5FE6584670F}"
                  SQLTask:SqlStatementSource="/*--------------------------------------------------------------------------------------------------------------------------------------------------------------------&#xA;                                     Purpose: calculate finance KPIS&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9; Developer: Jerry Shen&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9; Version: V1.0 07/08/2017 Created by Jerry Shen&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9; Note:&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;    1. put Recommended values in table &#x9;conform_finance.finance_variable_dim&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;2. need to think about @v_date???&#xA;---------------------------------------------------------------------------------------------------------------------------------------------------------------------*/&#xA;use dwhb;&#xA;&#xA;&#xA;&#xA;--------------------------------------------------Part1: define variable&#x9; ----------------------------------------------------------------------------------------&#xA;--kpi_report_date&#xA;declare @v_date datetime ='2017-05-01 00:00:00.000';&#xA;--financial_month_no&#xA;declare @v_fymont_no int = (select financial_month_no from conform_finance.date_dim where full_date =@v_date) &#xA;--financial_month_no_last&#xA;declare @v_fymont_last_no varchar(50);&#xA;set   @v_fymont_last_no =    &#xA;&#x9;   case @v_fymont_no &#x9; &#xA;&#x9;   when 1 then  '12,11,10,9,8,7,6,5,4,3,2'&#xA;&#x9;   when 2 then &#x9;'12,11,10,9,8,7,6,5,4,3'&#xA;&#x9;   when 3 then  '12,11,10,9,8,7,6,5,4'&#xA;&#x9;   when 4 then  '12,11,10,9,8,7,6,5'&#xA;&#x9;   when 5 then  '12,11,10,9,8,7,6'&#xA;&#x9;   when 6 then  '12,11,10,9,8,7'&#xA;&#x9;   when 7 then  '12,11,10,9,8'&#xA;&#x9;   when 8 then  '12,11,10,9'&#xA;&#x9;   when 9 then &#x9;'12,11,10'&#xA;&#x9;   when 10 then '12,11'&#xA;&#x9;   when 11 then '12'&#xA;&#x9;   when 12 then '-1'&#xA;       end;&#x9;&#x9;  &#xA;--entity no&#xA;declare @endity varchar(20) ='10';&#xA;--ledger_name for actual&#xA;declare @ldger_name_actual varchar(20);&#xA;  set  @ldger_name_actual =   right((select financial_year from conform_finance.date_dim where full_date =@v_date),2)+'GL_ACT';&#x9; &#xA;declare @ldger_name_actual_last varchar(20)= right((select financial_year from conform_finance.date_dim where full_date =DATEADD(YEAR, -1, @v_date)),2)+'GL_ACT';&#x9; ;&#x9;  ------------------calculate profit and loss becaue of 12 month rolling.&#xA;--ledger_name for budget&#xA;declare @ldger_name_budget varchar(20)= right((select financial_year from conform_finance.date_dim where full_date =@v_date),2)+'GL_BUD';&#x9; &#xA;--Recommended values&#xA;declare @RV_BDE decimal(6,4)   ; --Balancesheet Debt to Equity&#xA;set @RV_BDE=(select variable_value from conform_finance.finance_variable_dim where report_name ='KPI_Fact' and variable_name ='BalancesheetDebttoEquity' and validate_flag='Y' );&#xA;declare @RV_PLSIC decimal(6,4) ;  --Profit and Loss Statement: Interest cover&#xA;set @RV_PLSIC=(select variable_value from conform_finance.finance_variable_dim where report_name ='KPI_Fact' and variable_name ='ProfitandLossStatementInterestcover' and validate_flag='Y' );&#xA;declare @RV_EBITDA decimal(6,4) ;  --EBITDA : Turnover&#xA;set @RV_EBITDA=(select variable_value from conform_finance.finance_variable_dim where report_name ='KPI_Fact' and variable_name ='EBITDATurnover' and validate_flag='Y' );&#xA;declare @RV_CRAFRB decimal(6,4) ; --Balance sheet: Current Ratio adjusted for Resident Bonds &#x9;&#xA;set @RV_CRAFRB=(select variable_value from conform_finance.finance_variable_dim where report_name ='KPI_Fact' and variable_name ='BalancesheetCurrentRatioadjustedforResident' and validate_flag='Y' );&#xA;declare @RV_EBITDA_BUDGET decimal(6,4) ;  --EBITDA : Budget&#xA;set @RV_EBITDA_BUDGET=(select variable_value from conform_finance.finance_variable_dim where report_name ='KPI_Fact' and variable_name ='EBITDABudge' and validate_flag='Y' );&#xA;&#xA;&#xA;&#xA;&#xA;--delete existing data for same period&#xA;delete from  [conform_finance].kpi_fact&#xA;where date_key = (select date_key from conform_finance.date_dim where full_date =@v_date);&#xA;&#xA;------------Part2: start to populate KPI data for this period&#xA;--------------------------------------KPI1.Balancesheet Debt to Equity ------------------------------------------------------------------------------------&#xA;&#xA; insert into   [conform_finance].kpi_fact&#xA; select &#xA; 'Balancesheet Debt to Equity',&#xA;(select date_key from conform_finance.date_dim where full_date =@v_date),&#xA;'Debt',&#x9;&#x9;&#xA;(select sum( convert(decimal(20,2),amount))/1000 * (-1) from &#x9;  extract.GLF_Period_Balance_forKPI&#xA;where Entity in (@endity)  and  ledger_name =@ldger_name_actual&#xA;and period &lt;=@v_fymont_no&#xA;and account_group ='NCL'&#xA;and Account_Sub_Group='NCLFACIL'),&#xA;'Equity',&#xA;(&#xA;--reserversL&#xA;select&#xA;(&#xA;select sum( convert(decimal(20,2),amount))/1000 * (-1) from &#x9;  extract.GLF_Period_Balance_forKPI&#xA;where Entity in (@endity)  and  ledger_name =@ldger_name_actual&#xA;and period &lt;=@v_fymont_no&#xA;and account_group ='EQU'&#xA;)&#xA;-&#xA;(select sum( convert(decimal(20,2),amount))/1000 * (-1) from &#x9;  extract.GLF_Period_Balance_forKPI&#xA;where Entity in (@endity)  and  ledger_name =@ldger_name_actual&#xA;and period &lt;=@v_fymont_no&#xA;and Account_Sub_Group ='EQRE'&#xA;)&#xA;+  &#xA;&#xA;--Retained Surplus &#xA;(&#xA;select &#xA;&#xA;(select sum( convert(decimal(20,2),amount))/1000 *(-1)  from &#x9;  extract.GLF_Period_Balance_forKPI&#xA;where Entity in (@endity)  and  ledger_name =@ldger_name_actual&#xA;and period &lt;=@v_fymont_no&#xA;and Account_Sub_Group ='EQRE'&#xA;and account_group ='EQU'&#xA;)&#xA;+&#xA;(&#xA;select sum( convert(decimal(20,2),isnull(amount,0)))/1000*(-1) from &#x9;  extract.GLF_Period_Balance_forKPI&#xA;where Entity in (@endity)  and  ledger_name =@ldger_name_actual&#xA;and period &lt;=@v_fymont_no&#xA;and right(account_type,1) in (4,6)&#xA;&#xA;)&#xA;&#xA;)&#xA;),&#xA;null,&#xA;null,&#xA;null,&#xA;null,&#xA;'Result',&#xA;0.00,&#xA;null,&#xA;null,&#xA;'Recommended Maximum',&#xA;@RV_BDE,&#xA;null,&#xA;null;&#xA;&#xA;--update result&#xA;update &#x9;[conform_finance].kpi_fact&#xA;set kpi_result_1_value =kpi_indicator_1_value / kpi_indicator_2_value&#xA;where kpi_name ='Balancesheet Debt to Equity'&#xA;and date_key =(select date_key from conform_finance.date_dim where full_date =@v_date) ;&#xA;&#xA;--------------------------------------KPI2.Balance sheet: Current Ratio adjusted for Resident Bonds--------------------------------------------&#xA;insert into   [conform_finance].kpi_fact&#xA; select &#xA; 'Balance sheet: Current Ratio adjusted for Resident Bonds',&#xA;(select date_key from conform_finance.date_dim where full_date =@v_date),&#xA;'Current Assets',&#x9;&#x9;&#xA;(select sum( convert(decimal(20,2),amount))/1000 from &#x9;  extract.GLF_Period_Balance_forKPI&#xA;where Entity in (@endity)  and  ledger_name =@ldger_name_actual&#xA;and period &lt;=@v_fymont_no&#xA;and account_group ='CA'),&#xA;'Current Liabilities',&#xA;(select sum( convert(decimal(20,2),amount))/1000*(-1) from &#x9;  extract.GLF_Period_Balance_forKPI&#xA;where Entity in (@endity)  and  ledger_name =@ldger_name_actual&#xA;and period &lt;=@v_fymont_no&#xA;and account_group in ('CL')),&#xA;'Resident Bonds',&#xA;(select sum( convert(decimal(20,2),amount))/1000 from &#x9;  extract.GLF_Period_Balance_forKPI&#xA;where Entity in (@endity)  and  ledger_name =@ldger_name_actual&#xA;and period &lt;=@v_fymont_no&#xA;and account_group ='CA' and Account_Sub_Group in ('CABOND','CAACBOND')),&#xA;null,&#xA;null,&#xA;'Result',&#xA;0.00,&#xA;null,&#xA;null,&#xA;'Recommended Minimum',&#xA;@RV_CRAFRB,&#xA;null,&#xA;null;&#xA;&#xA;--update result&#xA;update &#x9;[conform_finance].kpi_fact&#xA;set kpi_result_1_value =kpi_indicator_1_value / kpi_indicator_2_value&#xA;where kpi_name ='Balance sheet: Current Ratio adjusted for Resident Bonds'&#xA;and date_key =(select date_key from conform_finance.date_dim where full_date =@v_date) ;&#xA;&#xA;&#xA;-----------------------------------KPI3:EBITDA : Budget----------------------------------------------------------------------------------------&#xA; insert into   [conform_finance].kpi_fact&#xA; select &#xA; 'EBITDA : Budget',&#xA; (select date_key from conform_finance.date_dim where full_date =@v_date),&#xA;'EBITDA Actual ',&#xA;(&#xA;select &#xA;&#xA;(&#xA;&#xA; select sum( convert(decimal(16,2),amount))/1000  from &#x9;  extract.GLF_Period_Balance_forKPI&#xA;where Entity in (@endity)  and  ledger_name =@ldger_name_actual&#xA;and period &lt;=@v_fymont_no&#xA;and Management_Report_L2  in ('DEPEXP','INTEXP')&#xA;and account_type in (4,6)&#xA;)&#xA;&#xA;+&#xA;(&#xA; select sum( convert(decimal(16,2),amount))/1000 *(-1) from &#x9;  extract.GLF_Period_Balance_forKPI&#xA;where Entity in (@endity)  and  ledger_name =@ldger_name_actual&#xA;and period &lt;=@v_fymont_no&#xA;and Management_Report_L2  in&#xA;(&#xA;'GOVFUND',&#xA;'RESCLFEE',&#xA;'ACACCINC',&#xA;'RENTRECD',&#xA;'OTHINC',&#xA;'LUNXFUND',&#xA;'SWGIF',&#xA;'SWGCST',&#xA;'SWGHK',&#xA;'SWGCTRNG',&#xA;'ONCOSTS',&#x9;&#xA;'CLNTEXP',&#xA;'FOODBEV',&#xA;'HKPNGEXP',&#xA;'MEDEXP',&#xA;'PURTRST',&#x9;&#xA;'OTHOCEXP',&#xA;'REPMNTRP', &#xA;'ADOFFEXP',&#xA;'FUNDEXP',&#xA;'OTHSTEXP',&#xA;'PRFINEXP',&#xA;'TRVMVH' ,&#xA;'DEPEXP',&#xA;'DISPFA',&#xA;'INTEXP',&#xA;'OHDRECH',&#xA; 'RETENINC',&#xA;'CAPINC',&#xA;'INVINC'   ,&#xA;'NA'&#xA;&#xA;)&#xA;and account_type in (4,6)&#xA;&#xA;&#xA;)  )&#xA;&#xA;,&#xA;'EBITDA Budget',&#xA;&#xA;(&#xA;select &#xA;&#xA;(&#xA;&#xA; select sum( convert(decimal(16,2),amount))/1000  from &#x9;  extract.GLF_Period_Balance_forKPI&#xA;where Entity in (@endity)  and  ledger_name =@ldger_name_budget&#xA;and period &lt;=@v_fymont_no&#xA;and Management_Report_L2  in ('DEPEXP','INTEXP')&#xA;and account_type in (4,6)&#xA;)&#xA;&#xA;+&#xA;(&#xA; select sum( convert(decimal(16,2),amount))/1000 *(-1) from &#x9;  extract.GLF_Period_Balance_forKPI&#xA;where Entity in (@endity)  and  ledger_name =@ldger_name_budget&#xA;and period &lt;=@v_fymont_no&#xA;and Management_Report_L2  in&#xA;(&#xA;'GOVFUND',&#xA;'RESCLFEE',&#xA;'ACACCINC',&#xA;'RENTRECD',&#xA;'OTHINC',&#xA;'LUNXFUND',&#xA;'SWGIF',&#xA;'SWGCST',&#xA;'SWGHK',&#xA;'SWGCTRNG',&#xA;'ONCOSTS',&#x9;&#xA;'CLNTEXP',&#xA;'FOODBEV',&#xA;'HKPNGEXP',&#xA;'MEDEXP',&#xA;'PURTRST',&#x9;&#xA;'OTHOCEXP',&#xA;'REPMNTRP', &#xA;'ADOFFEXP',&#xA;'FUNDEXP',&#xA;'OTHSTEXP',&#xA;'PRFINEXP',&#xA;'TRVMVH' ,&#xA;'DEPEXP',&#xA;'DISPFA',&#xA;'INTEXP',&#xA;'OHDRECH',&#xA; 'RETENINC',&#xA;'CAPINC',&#xA;'INVINC'   ,&#xA;'NA'&#xA;&#xA;)&#xA;and account_type in (4,6)&#xA;&#xA;&#xA;)  )&#xA; ,&#xA;null,&#xA;null,&#xA;null,&#xA;null,&#xA;'Result',&#xA;0.00,&#xA;null,&#xA;null,&#xA;'Recommended Minimum',&#xA;@RV_EBITDA_BUDGET,&#xA;null,&#xA;null;&#xA;&#xA;----------------------------------------KPI4: EBITDA : Turnover-------------------------------------------------------------------------------&#xA; insert into   [conform_finance].kpi_fact&#xA; select &#xA; 'EBITDA : Turnover',&#xA; (select date_key from conform_finance.date_dim where full_date =@v_date),&#xA;'EBITDA',&#xA; (&#xA;select &#xA;&#xA;(&#xA;&#xA; select sum( convert(decimal(16,2),amount))/1000  from &#x9;  extract.GLF_Period_Balance_forKPI&#xA;where Entity in (@endity)  and  ledger_name =@ldger_name_actual&#xA;and period =@v_fymont_no&#xA;and Management_Report_L2  in ('DEPEXP','INTEXP')&#xA;and account_type in (4,6)&#xA;)&#xA;&#xA;+&#xA;(&#xA; select sum( convert(decimal(16,2),amount))/1000 *(-1) from &#x9;  extract.GLF_Period_Balance_forKPI&#xA;where Entity in (@endity)  and  ledger_name =@ldger_name_actual&#xA;and period =@v_fymont_no&#xA;and Management_Report_L2  in&#xA;(&#xA;'GOVFUND',&#xA;'RESCLFEE',&#xA;'ACACCINC',&#xA;'RENTRECD',&#xA;'OTHINC',&#xA;'LUNXFUND',&#xA;'SWGIF',&#xA;'SWGCST',&#xA;'SWGHK',&#xA;'SWGCTRNG',&#xA;'ONCOSTS',&#x9;&#xA;'CLNTEXP',&#xA;'FOODBEV',&#xA;'HKPNGEXP',&#xA;'MEDEXP',&#xA;'PURTRST',&#x9;&#xA;'OTHOCEXP',&#xA;'REPMNTRP', &#xA;'ADOFFEXP',&#xA;'FUNDEXP',&#xA;'OTHSTEXP',&#xA;'PRFINEXP',&#xA;'TRVMVH' ,&#xA;'DEPEXP',&#xA;'DISPFA',&#xA;'INTEXP',&#xA;'OHDRECH',&#xA; 'RETENINC',&#xA;'CAPINC',&#xA;'INVINC'   ,&#xA;'NA'&#xA;&#xA;)&#xA;and account_type in (4,6)&#xA;&#xA;&#xA;)  &#xA;&#xA;)  ,&#xA;'Turnover',&#xA;&#xA;(&#xA;&#xA; select sum( convert(decimal(16,2),amount))/1000*(-1)  from &#x9;  extract.GLF_Period_Balance_forKPI&#xA;where Entity in (@endity)  and  ledger_name =@ldger_name_actual&#xA;and period =@v_fymont_no&#xA;and Management_Report_L2  in ('GOVFUND','RESCLFEE','ACACCINC','RENTRECD','OTHINC','LUNXFUND')&#xA;and account_type in (4,6)&#xA;) &#xA;,&#xA;null,&#xA;null,&#xA;null,&#xA;null,&#xA;'Result',&#xA;0.00,&#xA;null,&#xA;null,&#xA;'Recommended Minimum',&#xA;@RV_EBITDA,&#xA;null,&#xA;null;&#xA;&#xA;&#xA;--update result&#xA;update &#x9;[conform_finance].kpi_fact&#xA;set kpi_result_1_value =kpi_indicator_1_value / kpi_indicator_2_value&#xA;where kpi_name ='EBITDA : Turnover'&#xA;and date_key =(select date_key from conform_finance.date_dim where full_date =@v_date) ;&#xA;&#xA;&#xA;&#xA;&#xA;&#xA;--------------------------------------KPI5.Profit and Loss Statement: Interest cover ------------------------------------------------------------------------------------&#xA;&#xA; insert into   [conform_finance].kpi_fact&#xA; select &#xA; 'Profit and Loss Statement: Interest cover',&#xA;(select date_key from conform_finance.date_dim where full_date =@v_date),&#xA;'Surplus',&#x9;&#xA;(&#x9;&#xA;select&#xA;(&#xA;select sum( convert(decimal(20,2),amount)/1000)*(-1) &#xA;from  extract.GLF_Period_Balance_forKPI&#xA;where ledger_name  =@ldger_name_actual&#xA;and Entity  in (@endity) &#xA;and Period&lt;=@v_fymont_no&#xA;and Account_Type in (4,6)&#xA;)&#xA;&#xA;+&#xA;(&#xA;&#xA;select sum( convert(decimal(20,2),amount)/1000)*(-1) &#xA;from  extract.GLF_Period_Balance_forKPI&#xA;where ledger_name =@ldger_name_actual_last&#xA;and Entity  in (@endity) &#xA;and Period in (@v_fymont_last_no)&#xA;and Account_Type in (4,6)&#xA;)&#xA;),&#x9;  &#xA;'Interest on Debt',&#xA;(select &#x9;&#xA;(select sum( convert(decimal(20,2),amount)/1000) &#xA;from  extract.GLF_Period_Balance_forKPI&#xA;where ledger_name  =@ldger_name_actual&#x9;&#xA;and Entity  in (@endity) &#xA;and Period&lt;=@v_fymont_no&#xA;and right(account_number,5)  in('60640','60650','60655','60656','60657')&#xA;)&#xA;+&#xA;(&#xA;&#xA;select sum( convert(decimal(20,2),amount)/1000) &#xA;from  extract.GLF_Period_Balance_forKPI&#xA;where ledger_name =@ldger_name_actual_last&#x9;&#xA;and Entity  in (@endity) &#xA;and Period in (@v_fymont_last_no)&#xA;and right(account_number,5)  in('60640','60650','60655','60656','60657')&#xA;) ),&#x9; &#xA;null,&#xA;null,&#xA;null,&#xA;null,&#xA;'Result',&#xA;0.00,&#xA;null,&#xA;null,&#xA;'Recommended Minimum',&#xA;@RV_PLSIC,&#xA;null,&#xA;null;&#xA;&#xA;--update result&#xA;update &#x9;[conform_finance].kpi_fact&#xA;set kpi_result_1_value =kpi_indicator_1_value / kpi_indicator_2_value&#xA;where kpi_name ='Profit and Loss Statement: Interest cover'&#xA;and date_key =(select date_key from conform_finance.date_dim where full_date =@v_date) ;&#xA;&#xA;&#xA;&#xA;&#xA; -------------------------------insert into dwhf_finance kpi_fact table-------------------------------------------------------------------------&#xA; truncate table  dwhf_finance.finance.kpi_fact;&#xA; insert into  dwhf_finance.finance.kpi_fact&#xA; select * &#xA; from [conform_finance].kpi_fact;&#xA;" xmlns:SQLTask="www.microsoft.com/sqlserver/dts/tasks/sqltask" />
              </DTS:ObjectData>
            </DTS:Executable>
            <DTS:Executable
              DTS:refId="Package\Sequence Container - Fact Tables\SD1 - KPI_FACT\Truncate table"
              DTS:CreationName="Microsoft.ExecuteSQLTask"
              DTS:Description="Execute SQL Task"
              DTS:Disabled="True"
              DTS:DTSID="{7d09bfa1-0b7d-4f74-b014-4b95c9eaceb3}"
              DTS:ExecutableType="Microsoft.ExecuteSQLTask"
              DTS:LocaleID="-1"
              DTS:ObjectName="Truncate table"
              DTS:ThreadHint="0">
              <DTS:Variables />
              <DTS:ObjectData>
                <SQLTask:SqlTaskData
                  SQLTask:Connection="{6B844CC6-0F5A-4327-899C-E5FE6584670F}"
                  SQLTask:SqlStatementSource=" truncate table  dwhf_finance.finance.kpi_fact;" xmlns:SQLTask="www.microsoft.com/sqlserver/dts/tasks/sqltask" />
              </DTS:ObjectData>
            </DTS:Executable>
          </DTS:Executables>
          <DTS:PrecedenceConstraints>
            <DTS:PrecedenceConstraint
              DTS:refId="Package\Sequence Container - Fact Tables\SD1 - KPI_FACT.PrecedenceConstraints[Constraint]"
              DTS:CreationName=""
              DTS:DTSID="{5b841b50-2c25-4bc2-81f6-55210c8d323b}"
              DTS:From="Package\Sequence Container - Fact Tables\SD1 - KPI_FACT\EST - Write Job Start info"
              DTS:LogicalAnd="True"
              DTS:ObjectName="Constraint"
              DTS:To="Package\Sequence Container - Fact Tables\SD1 - KPI_FACT\Truncate table" />
            <DTS:PrecedenceConstraint
              DTS:refId="Package\Sequence Container - Fact Tables\SD1 - KPI_FACT.PrecedenceConstraints[Constraint 1]"
              DTS:CreationName=""
              DTS:DTSID="{b79325f8-ebd4-4f8e-8654-bdd26f570288}"
              DTS:From="Package\Sequence Container - Fact Tables\SD1 - KPI_FACT\Truncate table"
              DTS:LogicalAnd="True"
              DTS:ObjectName="Constraint 1"
              DTS:To="Package\Sequence Container - Fact Tables\SD1 - KPI_FACT\Get new records and update columns" />
            <DTS:PrecedenceConstraint
              DTS:refId="Package\Sequence Container - Fact Tables\SD1 - KPI_FACT.PrecedenceConstraints[Constraint 2]"
              DTS:CreationName=""
              DTS:DTSID="{c808a9c4-244e-4036-bae9-4f148338bbe9}"
              DTS:From="Package\Sequence Container - Fact Tables\SD1 - KPI_FACT\Get new records and update columns"
              DTS:LogicalAnd="True"
              DTS:ObjectName="Constraint 2"
              DTS:To="Package\Sequence Container - Fact Tables\SD1 - KPI_FACT\EST - Write Job Finish info" />
          </DTS:PrecedenceConstraints>
          <DTS:EventHandlers>
            <DTS:EventHandler
              DTS:refId="Package\Sequence Container - Fact Tables\SD1 - KPI_FACT.EventHandlers[OnError]"
              DTS:CreationName="OnError"
              DTS:DTSID="{462f70db-8feb-44f8-bbcb-88457a48c56d}"
              DTS:EventID="244"
              DTS:EventName="OnError"
              DTS:LocaleID="-1">
              <DTS:Variables>
                <DTS:Variable
                  DTS:CreationName=""
                  DTS:Description="The propagate property of the event"
                  DTS:DTSID="{7aab03fb-e87d-4fe0-ae7e-d3f4f2a5687c}"
                  DTS:IncludeInDebugDump="6789"
                  DTS:Namespace="System"
                  DTS:ObjectName="Propagate">
                  <DTS:VariableValue
                    DTS:DataType="11">-1</DTS:VariableValue>
                </DTS:Variable>
              </DTS:Variables>
              <DTS:Executables>
                <DTS:Executable
                  DTS:refId="Package\Sequence Container - Fact Tables\SD1 - KPI_FACT.EventHandlers[OnError]\Execute SQL Task - Catch Error Details"
                  DTS:CreationName="Microsoft.ExecuteSQLTask"
                  DTS:Description="Execute SQL Task"
                  DTS:DTSID="{8597932f-99e0-453d-916e-0b829360b04f}"
                  DTS:ExecutableType="Microsoft.ExecuteSQLTask"
                  DTS:LocaleID="-1"
                  DTS:ObjectName="Execute SQL Task - Catch Error Details">
                  <DTS:Variables />
                  <DTS:ObjectData>
                    <SQLTask:SqlTaskData
                      SQLTask:Connection="{6B844CC6-0F5A-4327-899C-E5FE6584670F}"
                      SQLTask:SqlStatementSource="-- insert into management.ERROR_EVENT_DETAIL_FACT table&#xA;&#xA;insert into management.ERROR_EVENT_DETAIL_FACT&#xA;SELECT &#xA;(SELECT DATE_KEY FROM management.DATE_DIM WHERE CONVERT(DATE,FULL_DATE)=CONVERT(DATE,GETDATE()) )&#xA;,(SELECT batch_key FROM management.BATCH_DIM WHERE BATCH_TYPE='batch') &#xA;,T2.TABLE_KEY&#xA;,T2.TABLE_KEY&#xA;,?&#xA;,' '&#xA;,4&#xA;FROM  management.TABLE_DIM T2&#xA;WHERE T2.[SCHEMA]+'.'+T2.TABLE_NAME='conform.employee_termination_fact'&#xA;&#xA;&#xA;-- insert into [management].ETL_PROCESS_FACT with 'Failed'&#xA;INSERT INTO [management].ETL_PROCESS_FACT&#xA;SELECT  &#xA;(SELECT DATE_KEY FROM management.DATE_DIM WHERE CONVERT(DATE,FULL_DATE)=CONVERT(DATE,GETDATE()) )&#xA;,(SELECT batch_key FROM management.BATCH_DIM WHERE BATCH_TYPE='batch')&#xA;, T2.TABLE_KEY&#xA;,3&#xA;,GETDATE() &#xA;,4&#xA;,'Update Fact Table'    &#xA;FROM  management.TABLE_DIM T2&#xA;WHERE T2.[SCHEMA]+'.'+T2.TABLE_NAME='conform.employee_termination_fact'&#xA;&#xA; -- insert into management.ERROR_EVENT_FACT table&#xA;insert into management.ERROR_EVENT_FACT&#xA;SELECT &#xA;(SELECT batch_key FROM management.BATCH_DIM WHERE BATCH_TYPE='batch') &#xA;,(SELECT DATE_KEY FROM management.DATE_DIM WHERE CONVERT(DATE,FULL_DATE)=CONVERT(DATE,GETDATE()) )&#xA;,convert(varchar, getdate(),21)&#xA;, 'HIGH'&#xA;,4&#xA;FROM  management.TABLE_DIM T2&#xA;WHERE T2.[SCHEMA]+'.'+T2.TABLE_NAME='conform.employee_termination_fact'&#xA;&#xA;" xmlns:SQLTask="www.microsoft.com/sqlserver/dts/tasks/sqltask">
                      <SQLTask:ParameterBinding
                        SQLTask:ParameterName="0"
                        SQLTask:DtsVariableName="System::ErrorDescription"
                        SQLTask:ParameterDirection="Input"
                        SQLTask:DataType="130"
                        SQLTask:ParameterSize="-1" />
                    </SQLTask:SqlTaskData>
                  </DTS:ObjectData>
                </DTS:Executable>
              </DTS:Executables>
            </DTS:EventHandler>
          </DTS:EventHandlers>
        </DTS:Executable>
        <DTS:Executable
          DTS:refId="Package\Sequence Container - Fact Tables\SD1 - LSL_FACT"
          DTS:CreationName="STOCK:SEQUENCE"
          DTS:Description="Sequence Container"
          DTS:DTSID="{65ce6689-b1e8-403f-9cd1-6694bbe03fd3}"
          DTS:ExecutableType="STOCK:SEQUENCE"
          DTS:LocaleID="-1"
          DTS:ObjectName="SD1 - LSL_FACT">
          <DTS:Variables />
          <DTS:Executables>
            <DTS:Executable
              DTS:refId="Package\Sequence Container - Fact Tables\SD1 - LSL_FACT\EST - Write Job Finish info"
              DTS:CreationName="Microsoft.ExecuteSQLTask"
              DTS:Description="Execute SQL Task"
              DTS:Disabled="True"
              DTS:DTSID="{896f189d-14de-43ab-8cca-de7e8f8d9560}"
              DTS:ExecutableType="Microsoft.ExecuteSQLTask"
              DTS:LocaleID="-1"
              DTS:ObjectName="EST - Write Job Finish info"
              DTS:TaskContact="Execute SQL Task; Microsoft Corporation; SQL Server 2016; © 2015 Microsoft Corporation; All Rights Reserved;http://www.microsoft.com/sql/support/default.asp;1"
              DTS:ThreadHint="0">
              <DTS:Variables />
              <DTS:ObjectData>
                <SQLTask:SqlTaskData
                  SQLTask:Connection="{6B844CC6-0F5A-4327-899C-E5FE6584670F}"
                  SQLTask:SqlStatementSource="INSERT INTO [management].ETL_PROCESS_FACT&#xA;SELECT  &#xA;(SELECT DATE_KEY FROM management.DATE_DIM WHERE CONVERT(DATE,FULL_DATE)=CONVERT(DATE,GETDATE()) )&#xA;,(SELECT batch_key FROM management.BATCH_DIM WHERE BATCH_TYPE='batch')&#xA;, T2.TABLE_KEY&#xA;,2&#xA;,GETDATE() ,&#xA;4,&#xA;'Finish updating FACT table'&#xA;FROM  management.TABLE_DIM T2&#xA;WHERE T2.[SCHEMA]+'.'+T2.TABLE_NAME='conform_finance.KPI_fact'&#xA;" xmlns:SQLTask="www.microsoft.com/sqlserver/dts/tasks/sqltask" />
              </DTS:ObjectData>
            </DTS:Executable>
            <DTS:Executable
              DTS:refId="Package\Sequence Container - Fact Tables\SD1 - LSL_FACT\EST - Write Job Start info"
              DTS:CreationName="Microsoft.ExecuteSQLTask"
              DTS:Description="Execute SQL Task"
              DTS:Disabled="True"
              DTS:DTSID="{fa958f91-3fcb-4042-b5b1-e437794f00a2}"
              DTS:ExecutableType="Microsoft.ExecuteSQLTask"
              DTS:LocaleID="-1"
              DTS:ObjectName="EST - Write Job Start info"
              DTS:TaskContact="Execute SQL Task; Microsoft Corporation; SQL Server 2016; © 2015 Microsoft Corporation; All Rights Reserved;http://www.microsoft.com/sql/support/default.asp;1"
              DTS:ThreadHint="0">
              <DTS:Variables />
              <DTS:ObjectData>
                <SQLTask:SqlTaskData
                  SQLTask:Connection="{6B844CC6-0F5A-4327-899C-E5FE6584670F}"
                  SQLTask:SqlStatementSource="INSERT INTO [management].ETL_PROCESS_FACT&#xA;SELECT  &#xA;(SELECT DATE_KEY FROM management.DATE_DIM WHERE CONVERT(DATE,FULL_DATE)=CONVERT(DATE,GETDATE()) )&#xA;,(SELECT batch_key FROM management.BATCH_DIM WHERE BATCH_TYPE='batch')&#xA;, T2.TABLE_KEY&#xA;,1&#xA;,GETDATE() ,&#xA;4,&#xA;'Start to update FACT table'&#xA;FROM  management.TABLE_DIM T2&#xA;WHERE T2.[SCHEMA]+'.'+T2.TABLE_NAME='conform_finance.KPI_FACT'&#xA;" xmlns:SQLTask="www.microsoft.com/sqlserver/dts/tasks/sqltask" />
              </DTS:ObjectData>
            </DTS:Executable>
            <DTS:Executable
              DTS:refId="Package\Sequence Container - Fact Tables\SD1 - LSL_FACT\Get new records and update columns"
              DTS:CreationName="Microsoft.ExecuteSQLTask"
              DTS:Description="Execute SQL Task"
              DTS:DTSID="{92a5692d-888e-414c-9d02-600ae58a7308}"
              DTS:ExecutableType="Microsoft.ExecuteSQLTask"
              DTS:LocaleID="-1"
              DTS:ObjectName="Get new records and update columns"
              DTS:ThreadHint="0">
              <DTS:Variables />
              <DTS:ObjectData>
                <SQLTask:SqlTaskData
                  SQLTask:Connection="{6B844CC6-0F5A-4327-899C-E5FE6584670F}"
                  SQLTask:SqlStatementSource="/*----------------------------------------------------------------------------------------------------------------------------------------------------------&#xA;                                     Purpose: calculate finance LSL&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9; Developer: Jerry Shen&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9; Version: V1.0 17/08/2017 Created by Jerry Shen&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9; Note:&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;    1. need to chekc Probability%??&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;  update &#x9; conform_finance.lsl_fact &#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9; set Probability=&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;  case Years_Rounded_Down&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;  when 6 then &#x9;0.87&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;  when 5 then &#x9;0.5&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;  when 4 then &#x9;0.12&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;  when 3 then &#x9;0.12&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;  when 2 then &#x9;0.12&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;  when 1 then &#x9;0.12&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;  when 0 then 0.12&#xA;&#x9;&#x9;     &#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;  else 1&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;  end;&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;2. report run monthly -- set up to run it at first day of month for previous month&#xA;--------------------------------------------------------------------------------------------------------------------------------------------------------------*/&#xA;use dwhb;&#xA;&#xA;----------------------------Part1: Set up variables-----------------------------------------------------------------------------------------------------------&#xA;&#xA;--report date: run every month at the first day&#xA;--exampple: if today is 2017-08-01, then ETL will run date for July 2017&#xA;--Logic to check whether the ETL needs to run or not&#xA;--If first day of month, then run the ETL&#xA;if ((select right(convert(varchar,convert(date,getdate())),2)) ='01')&#xA;begin&#xA;declare @v_date datetime =getdate()-1 ;&#xA;&#xA;--Get valiable values from conform_finance.finance_variable_dim&#xA;declare @v_Super   decimal(6,4) ;&#xA;set @v_Super=(select variable_value from conform_finance.finance_variable_dim where report_name ='LSL_Fact' and variable_name ='super_rate' and validate_flag='Y' );&#xA;declare @v_Ave_WC_Rate decimal(6,4) ;&#xA;set @v_Ave_WC_Rate=(select variable_value from conform_finance.finance_variable_dim where report_name ='LSL_Fact' and variable_name ='ave_wc_rate' and validate_flag='Y' );&#xA;declare @v_LY_Ave_Workcover_rate decimal(6,4) ;&#xA;set @v_LY_Ave_Workcover_rate=(select variable_value from conform_finance.finance_variable_dim where report_name ='LSL_Fact' and variable_name ='ly_ave_wc_rate' and validate_flag='Y' );&#xA;declare @v_casual_factor decimal(6,4) ;&#xA;set @v_casual_factor=(select variable_value from conform_finance.finance_variable_dim where report_name ='LSL_Fact' and variable_name ='casual_factor' and validate_flag='Y' );&#xA;&#xA;/*&#xA;Inflation Rate&#x9;&#x9;&#xA;Years of Service&#x9;Rate of Increase per year&#x9;Mulitplication Rate&#xA;6&#x9;2%&#x9;1.02&#xA;5&#x9;2%&#x9;1.0404&#xA;4&#x9;2%&#x9;1.061208&#xA;3&#x9;2%&#x9;1.08243216&#xA;2&#x9;2%&#x9;1.104080803&#xA;1&#x9;2%&#x9;1.126162419&#xA;&#xA;&#xA;Discount rate for NPV&#x9;&#x9;&#xA;Years&#x9;Rate&#x9;Factor&#xA;1&#x9;2.36&#x9;0.976959&#xA;2&#x9;2.59&#x9;0.950204&#xA;3&#x9;2.83&#x9;0.919727&#xA;4&#x9;3.06&#x9;0.886307&#xA;5&#x9;3.28&#x9;0.851&#xA;6&#x9;3.47&#x9;0.814773&#xA;7&#x9;3.64&#x9;0.778395&#x9;&#x9;&#xA;*/&#xA;&#xA;&#xA;----------------------------Part2: calucation for LSL_Fact----------------------------------------------------------------------------------------------------&#xA;&#xA;&#xA;--delete existing data for calculate_date.&#xA;delete from conform_finance.lsl_fact&#xA;where calcualte_date_key = (select date_key from conform_finance.date_dim where full_date =@v_date)&#x9; ;&#xA;&#xA;--declare temp table to get employee_primary_position&#xA;declare @t_primary_position TABLE&#xA;(&#xA;id_number int,&#xA;portfolio varchar(10),&#xA;servicestream varchar(10),&#xA;program varchar(10),&#xA;pri_position_code varchar(10)  ,&#xA;pri_position_key int&#xA;)&#x9;  ;&#xA;&#xA;insert into @t_primary_position&#xA;select&#xA;t6.id_number,&#xA;t2.portfolio_code,&#xA;t3.service_stream_code,&#xA;t4.program_code,&#xA;t5.position_code  ,&#xA;null&#xA;from conform.employee_position_fact as t1&#xA;inner join conform.portfolio_dim as t2 on t1.portfolio_key =t2. portfolio_key and t2.current_row_indicator='Y'&#xA;inner join conform.service_stream_dim as t3 on t1.service_stream_key =t3. service_stream_key and t3.current_row_indicator='Y'&#xA;inner join conform.program_dim as t4 on t1.program_key =t4. program_key and t4.current_row_indicator='Y'&#xA;inner join conform.position_dim as t5 on t1.position_key = t5.position_key and &#x9; t5.current_row_indicator='Y'&#xA;inner join &#x9;conform.employee_dim as t6 on t1.employee_key = t6.employee_key and t6.current_row_indicator='Y'&#xA;inner join conform.date_dim as t7 on t1.position_start_date_key=t7.date_key and t7.full_date&lt;=@v_date&#xA;where  t1.primary_position_flag='p'&#xA;&#xA;--update position_key using conform_finance.position_dim&#xA;update t1&#xA;set t1.pri_position_key=t2.position_key&#xA;from @t_primary_position as t1&#xA;inner join &#x9; conform_finance.position_dim  as t2 on t1.pri_position_code=t2.position_code and t2.current_row_indicator='Y'&#xA;&#xA;&#xA;&#xA;--populate employee&#x9;basic information and primary position data&#xA;insert into conform_finance.lsl_fact&#xA;(&#xA;calcualte_date_key,&#xA; employee_key ,&#xA;portfolio_key ,&#xA;service_stream_key ,&#xA;program_key&#x9;   ,&#xA;primary_position_key &#xA;&#xA;)&#xA;select &#xA;(select date_key from conform.date_dim where full_date =@v_date),&#xA;t6.employee_key ,&#xA;t2.portfolio_key,&#xA;t3.service_stream_key,&#xA;t4.program_key&#x9; ,&#xA;t1.pri_position_key&#xA;from @t_primary_position as t1&#xA;inner join conform_finance.portfolio_dim as t2 on t1.portfolio=t2.portfolio_code and t2.current_row_indicator='Y'&#xA;inner join conform_finance.service_stream_dim as t3 on t1.servicestream=t3.service_stream_code and t2.current_row_indicator='Y'&#xA;inner join conform_finance.program_dim as t4 on t1.program=t4.program_code and t3.current_row_indicator='Y'&#xA;inner join &#x9;  conform_finance.employee_dim as t6 on t1.id_number =t6.id_number and t6.current_row_indicator='Y'&#xA;&#xA;--select * from conform_finance.lsl_fact &#xA;&#xA;-- populate&#x9;Primary_Work_Location&#xA;&#xA;update i1&#xA;set i1.Primary_Work_Location=i3.WORK_LOCATION2 &#xA;from  conform_finance.lsl_fact as i1&#xA;inner join conform_finance.employee_dim as i2 on i1.employee_key = i2.employee_key&#x9; and i2.current_row_indicator='Y'&#xA;inner join &#xA;(  select &#xA;g1.*,&#xA;g2.code_descr as work_location2&#x9;&#x9;  &#xA;from&#xA;(&#xA;select t1.id_number,t1.position_code,t1.work_location  ,t1.WORK_GROUP  ,t1.DEPARTMENT_CODE&#xA;from extract.hrhmn_empl_job_pos as t1&#xA;inner join&#xA; (select id_number, position_code,max(EFFECTIVE_DATE) as EFFECTIVE_DATE&#xA;  from &#x9;extract.hrhmn_empl_job_pos where POSITION_TYPE_IND='P'&#x9;and id_number not in (select id_number from extract.hrhmn_emplterm_dtl)&#x9;&#x9;  and end_date ='1900-01-01 00:00:00.000'&#xA;  group by id_number, position_code   )&#xA;as t2&#xA;on t1.id_number =t2.id_number &#xA;and t1.POSITION_CODE=t2.POSITION_CODE&#xA;and t1.EFFECTIVE_DATE=t2.EFFECTIVE_DATE&#x9;&#xA;where t1.POSITION_TYPE_IND='P'&#xA;and t1.id_number not in (select id_number from extract.hrhmn_emplterm_dtl)&#x9;&#x9;&#x9;&#x9;and t1.end_date ='1900-01-01 00:00:00.000'&#xA;) as g1 &#xA;inner join &#xA;(SELECT code_descr,code_id  as location&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#x9;&#xA;  FROM [DWHB].[extract].[hrstc_code]   where code_type like '%Location%'&#x9;&#x9;) as g2&#xA;  on g1.WORK_LOCATION=g2.location&#x9;) as i3 on i2.id_number =i3.id_number  &#xA;&#xA;&#xA;--populate&#x9;Primary_Cost_Centre&#x9; &#xA; update i1&#xA;set i1.Primary_Cost_Centre=g2.seln_code1&#xA;from  conform_finance.lsl_fact as i1&#xA;inner join conform_finance.employee_dim as i2 on i1.employee_key = i2.employee_key&#x9; and i2.current_row_indicator='Y'&#xA;  inner join &#xA;  (&#xA;&#xA;select t1.* from extract.hrsys_usrseln_dtl    as t1&#xA;inner join &#xA;(&#xA;select  entity_key_1, max(last_mod_datei) as  last_mod_datei&#xA;from extract.hrsys_usrseln_dtl &#xA;where &#x9; entity_type ='EPS'&#xA;group by  entity_key_1) as t2&#xA;on t1.entity_key_1 = t2.entity_key_1&#xA;and t1.last_mod_datei=t2.last_mod_datei&#xA;where t1.entity_type ='EPS' &#xA;) as g2&#xA;on i2.id_number =g2.entity_key_1&#xA;&#xA;&#xA;&#xA;--fix location is null&#xA;update &#x9;t1&#xA;set    t1.primary_work_location&#x9; = t2.primary_work_location&#xA;from   conform_finance.lsl_fact as t1&#xA;inner join &#xA;(select    distinct primary_cost_centre,primary_work_location&#xA; from   conform_finance.lsl_fact&#xA; where &#x9;primary_cost_centre is not null &#xA; and   primary_work_location is not null&#xA; ) as t2&#xA; on  t1.primary_cost_centre=t2.primary_cost_centre&#xA; where t1.primary_work_location is null&#xA;&#xA;&#xA;-- update date_of_service&#xA;&#xA;update &#x9;f1&#xA;set f1.Date_of_Service=f2.val_date2&#xA;from  conform_finance.lsl_fact as f1&#xA;inner join&#xA;(&#x9;  select t1.id_number,t1.val_date2 , t3.employee_key&#xA;&#x9;  from  [DWHB].[extract].[HRHMN_USR_FLD] as t1&#xA;&#x9;  inner join &#xA;&#x9;    (&#x9;&#xA;&#x9;&#x9;select id_number, max(last_mod_datei) as last_mod_datei&#xA;&#x9;&#x9;from   [DWHB].[extract].[HRHMN_USR_FLD]&#xA;&#x9;&#x9;group by id_number&#xA;&#x9;&#x9;) as t2 on t1.id_number =t2.id_number and t1.last_mod_datei= t2.last_mod_datei&#xA;&#x9;  inner join conform_finance.employee_dim as t3 on t1.id_number =t3.id_number and t3.current_row_indicator='Y'&#xA;&#x9;&#xA;) as f2&#xA;on f1.employee_key=f2.employee_key&#xA;&#xA;&#xA;&#xA;--Years_of_Completed_Service_asat_calculateday&#xA; update  conform_finance.lsl_fact&#xA; set Years_of_Completed_Service_asat_calculateday =  datediff(day, Date_of_Service,@v_date)&#x9;   /365.25&#x9;;&#xA;&#xA;-- Years_Rounded_Down&#xA;  update  conform_finance.lsl_fact&#xA; set Years_Rounded_Down =  FLOOR(Years_of_Completed_Service_asat_calculateday)&#x9;;&#xA;&#xA; --Weeks based on Completed years of Service&#xA;  update  conform_finance.lsl_fact&#xA; set Weeks_basedon_Completed_yearsofService = Years_Rounded_Down * 1.3&#x9;;&#xA;&#xA;&#xA;&#xA;--Current_NonCurrent&#xA;   update  conform_finance.lsl_fact&#xA; set Current_NonCurrent = case when Years_Rounded_Down &gt; 6 then 'Current' else 'Non-Current' end;&#xA;&#xA;&#xA;--c8000or9000&#xA;   update  conform_finance.lsl_fact&#xA; set c8000or9000 = case when Primary_Cost_Centre &gt;'1105' and Primary_Cost_Centre&lt;'1500' then '8000' else '9000' end;&#xA;&#xA;--Weeks as at calculate_date&#xA;&#x9; update f1&#xA;&#x9; set   f1.Weeks_asat_calculateday=isnull(f3.LSL_balance&#x9;,0)&#xA;&#x9; from   conform_finance.lsl_fact as f1&#xA;&#x9; inner join    conform_finance.employee_dim as f2 on f1.employee_key =f2.employee_key and f2.current_row_indicator='Y'&#xA;&#x9; inner join&#xA;&#x9; (&#xA; &#x9;  select t1.id_number, t1.ACCRUAL_HOURS,t1.ACCRUAL_PRORATA,t1.ACCRUAL_TAKEN, t1.ACCRUAL_HOURS+t1.ACCRUAL_PRORATA-t1.ACCRUAL_TAKEN as LSL_balance&#xA;&#x9;  from &#x9;extract.HREEN_EMPLENT_ACCR&#x9;as t1&#xA;&#x9;  inner join &#xA;&#x9;  ( select id_number,max(LAST_MOD_DATEI) as LAST_MOD_DATEI&#xA;&#x9;&#x9;from extract.HREEN_EMPLENT_ACCR&#x9;&#xA;&#x9;&#x9;where  PAY_COMPONENT_REF='1226.0'&#xA;&#x9;&#x9;and LAST_MOD_DATEI&lt;=@v_date&#xA;&#x9;&#x9;group by id_number) as t2&#xA;   &#x9;  on t1.id_number =t2.id_number &#xA;&#x9;   and t1.LAST_MOD_DATEI  =t2.LAST_MOD_DATEI&#xA;&#x9;  where  t1.PAY_COMPONENT_REF='1226.0'&#xA;&#x9;&#x9;and t1.LAST_MOD_DATEI&lt;=@v_date&#xA;&#x9;&#x9;) f3 on f2.id_number&#x9;  =f3. ID_NUMBER and f2.current_row_indicator='Y'&#xA;&#x9;&#x9;--if years rounded down&lt;7 update it same as  Weeks based on Completed years of Service&#xA;&#x9;&#x9; update conform_finance.lsl_fact&#xA;&#x9;&#x9; set Weeks_asat_calculateday = Weeks_basedon_Completed_yearsofService&#xA;&#x9;&#x9; where &#x9; Years_Rounded_Down&lt;7;&#xA;&#xA;&#xA;  --update lsl_averate_hours&#xA;    update f1&#xA;&#x9; set   f1.LSL_Average_Hours=isnull(f3.lsl_averate_hours&#x9;,0)&#xA;&#x9; from   conform_finance.lsl_fact as f1&#xA;&#x9; inner join    conform_finance.employee_dim as f2 on f1.employee_key =f2.employee_key and f2.current_row_indicator='Y'&#xA;&#x9; inner join&#xA;&#x9; (&#xA;   select t1.id_number,t1.val_num1 as lsl_averate_hours&#xA;&#x9;  from  [DWHB].[extract].[HRHMN_USR_FLD] as t1&#xA;&#x9;  inner join &#xA;&#x9;    (&#x9;&#xA;&#x9;&#x9;select id_number, max(last_mod_datei) as last_mod_datei&#xA;&#x9;&#x9;from   [DWHB].[extract].[HRHMN_USR_FLD]&#xA;&#x9;&#x9;group by id_number&#xA;&#x9;&#x9;) as t2 on t1.id_number =t2.id_number and t1.last_mod_datei= t2.last_mod_datei&#xA;&#x9;  inner join conform_finance.employee_dim as t3 on t1.id_number =t3.id_number and t3.current_row_indicator='Y'&#xA;&#x9;  inner join conform.date_dim as t4 on t1.val_date2= t4.full_date &#xA;&#x9;  &#x9;) f3 on f2.id_number&#x9;  =f3. ID_NUMBER and f2.current_row_indicator='Y';&#xA;--hours&#xA;update &#x9; conform_finance.lsl_fact&#xA;set hours = Weeks_asat_calculateday *LSL_Average_Hours; &#xA;&#xA;---------------------------------------------hours rates -------------------------------------------------------&#xA;&#xA;update f1&#xA;set f1.Hourly_Rate=f4.pay_item_rate&#xA;from  conform_finance.lsl_fact as f1&#xA;inner join    conform_finance.employee_dim as f2 on f1.employee_key =f2.employee_key and f2.current_row_indicator='Y'&#xA;inner join    conform_finance.position_dim as f3 on f1.primary_position_key =f3.position_key and f3.current_row_indicator='Y'&#xA;inner join&#xA;(&#xA;&#xA;select&#xA;&#x9;i1.id_number,i1.position_code,max(i1.pay_item_rate) as pay_item_rate &#xA;from &#xA;(&#xA;select id_number,PAY_PERIOD_ENDDATE,pay_item_rate,POSITION_CODE&#xA;from extract.HRPAY_PAYITEMS_DTL&#x9; &#xA;where PAY_COMPONENT_DEF =100 and  pay_component_ref =&#x9; 100&#xA;--and PAY_PERIOD_ENDDATE&gt;='2016-11-21 00:00:00.000'&#xA;and PAY_PERIOD_ENDDATE&lt;=@v_date&#xA;) as i1&#xA;inner join&#xA;(&#xA;select g1.id_number,g1.pay_item_rate,g1.POSITION_CODE,max(g1.PAY_PERIOD_ENDDATE) as PAY_PERIOD_ENDDATE&#xA;from &#xA;(&#xA;select id_number,PAY_PERIOD_ENDDATE,pay_item_rate,POSITION_CODE&#xA;from extract.HRPAY_PAYITEMS_DTL&#x9; &#xA;where PAY_COMPONENT_DEF =100 and  pay_component_ref =&#x9; 100&#xA;--and PAY_PERIOD_ENDDATE&gt;='2016-11-21 00:00:00.000'&#xA;and PAY_PERIOD_ENDDATE&lt;=@v_date&#xA;) as g1&#xA;group by   g1.id_number,g1.pay_item_rate,g1.POSITION_CODE&#xA; ) as i2&#xA; on i1.id_number=i2.id_number and i1.POSITION_CODE=i2.POSITION_CODE and i1.pay_item_rate=i2.pay_item_rate and i1.PAY_PERIOD_ENDDATE=i2.PAY_PERIOD_ENDDATE&#xA;group by i1.id_number,i1.position_code&#xA;&#xA;) as f4 on f2.id_number=f4.ID_NUMBER  &#xA;and f3.position_code=f4.POSITION_CODE&#x9;COLLATE DATABASE_DEFAULT &#xA;-- for some employee if they have&#xA;--case 1:  maternity leave paid&#xA;   update f1&#xA;set f1.Hourly_Rate=f4.pay_item_rate&#xA;from  conform_finance.lsl_fact as f1&#xA;inner join    conform_finance.employee_dim as f2 on f1.employee_key =f2.employee_key and f2.current_row_indicator='Y'&#xA;inner join    conform_finance.position_dim as f3 on f1.primary_position_key =f3.position_key and f3.current_row_indicator='Y'&#xA;inner join&#xA;(&#xA;select id_number,PAY_PERIOD_ENDDATE,pay_item_rate,POSITION_CODE&#xA;from extract.HRPAY_PAYITEMS_DTL&#x9; &#xA;where PAY_COMPONENT_DEF =500 &#xA;--and PAY_PERIOD_ENDDATE&gt;='2016-11-21 00:00:00.000'&#xA;and PAY_PERIOD_ENDDATE&lt;=@v_date &#xA;) as f4 on f2.id_number=f4.ID_NUMBER  &#xA;and f3.position_code=f4.POSITION_CODE&#x9;COLLATE DATABASE_DEFAULT &#xA;where f1.Hourly_Rate is null&#xA;&#xA;&#xA;--case2: cannot up and don't map position key&#xA;update f1&#xA;set f1.Hourly_Rate=f4.pay_item_rate&#xA;from  conform_finance.lsl_fact as f1&#xA;inner join    conform_finance.employee_dim as f2 on f1.employee_key =f2.employee_key and f2.current_row_indicator='Y'&#xA;inner join    conform_finance.position_dim as f3 on f1.primary_position_key =f3.position_key and f3.current_row_indicator='Y'&#xA;inner join&#xA;(&#xA;&#xA;select&#xA;&#x9;i1.id_number,i1.position_code,max(i1.pay_item_rate) as pay_item_rate &#xA;from &#xA;(&#xA;select id_number,PAY_PERIOD_ENDDATE,pay_item_rate,POSITION_CODE&#xA;from extract.HRPAY_PAYITEMS_DTL&#x9; &#xA;where PAY_COMPONENT_DEF =100 and  pay_component_ref =&#x9; 100&#xA;--and PAY_PERIOD_ENDDATE&gt;='2016-11-21 00:00:00.000'&#xA;and PAY_PERIOD_ENDDATE&lt;=@v_date&#xA;) as i1&#xA;inner join&#xA;(&#xA;select g1.id_number,g1.pay_item_rate,g1.POSITION_CODE,max(g1.PAY_PERIOD_ENDDATE) as PAY_PERIOD_ENDDATE&#xA;from &#xA;(&#xA;select id_number,PAY_PERIOD_ENDDATE,pay_item_rate,POSITION_CODE&#xA;from extract.HRPAY_PAYITEMS_DTL&#x9; &#xA;where PAY_COMPONENT_DEF =100 and  pay_component_ref =&#x9; 100&#xA;--and PAY_PERIOD_ENDDATE&gt;='2016-11-21 00:00:00.000'&#xA;and PAY_PERIOD_ENDDATE&lt;=@v_date&#xA;) as g1&#xA;group by   g1.id_number,g1.pay_item_rate,g1.POSITION_CODE&#xA; ) as i2&#xA; on i1.id_number=i2.id_number and i1.POSITION_CODE=i2.POSITION_CODE and i1.pay_item_rate=i2.pay_item_rate and i1.PAY_PERIOD_ENDDATE=i2.PAY_PERIOD_ENDDATE&#xA;group by i1.id_number,i1.position_code&#xA;&#xA;) as f4 on f2.id_number=f4.ID_NUMBER  &#xA;--and f3.position_code=f4.POSITION_CODE&#x9;COLLATE DATABASE_DEFAULT &#xA;where f1. Hourly_Rate is null &#xA;&#xA;--case3: no pay records when @v_date and move to next pay_period.&#xA;update f1&#xA;set f1.Hourly_Rate=f4.pay_item_rate&#xA;from  conform_finance.lsl_fact as f1&#xA;inner join    conform_finance.employee_dim as f2 on f1.employee_key =f2.employee_key and f2.current_row_indicator='Y'&#xA;inner join    conform_finance.position_dim as f3 on f1.primary_position_key =f3.position_key and f3.current_row_indicator='Y'&#xA;inner join&#xA;(&#xA;&#xA;select&#xA;&#x9;i1.id_number,i1.position_code,max(i1.pay_item_rate) as pay_item_rate &#xA;from &#xA;(&#xA;select id_number,PAY_PERIOD_ENDDATE,pay_item_rate,POSITION_CODE&#xA;from extract.HRPAY_PAYITEMS_DTL&#x9; &#xA;where PAY_COMPONENT_DEF =100 and  pay_component_ref =&#x9; 100&#xA;--and PAY_PERIOD_ENDDATE&gt;='2016-11-21 00:00:00.000'&#xA;and PAY_PERIOD_ENDDATE&lt;=DATEADD(day,28,@v_date)&#xA;) as i1&#xA;inner join&#xA;(&#xA;select g1.id_number,g1.pay_item_rate,g1.POSITION_CODE,max(g1.PAY_PERIOD_ENDDATE) as PAY_PERIOD_ENDDATE&#xA;from &#xA;(&#xA;select id_number,PAY_PERIOD_ENDDATE,pay_item_rate,POSITION_CODE&#xA;from extract.HRPAY_PAYITEMS_DTL&#x9; &#xA;where PAY_COMPONENT_DEF =100 and  pay_component_ref =&#x9; 100&#xA;--and PAY_PERIOD_ENDDATE&gt;='2016-11-21 00:00:00.000'&#xA;and PAY_PERIOD_ENDDATE&lt;=DATEADD(day,28,@v_date)&#xA;) as g1&#xA;group by   g1.id_number,g1.pay_item_rate,g1.POSITION_CODE&#xA; ) as i2&#xA; on i1.id_number=i2.id_number and i1.POSITION_CODE=i2.POSITION_CODE and i1.pay_item_rate=i2.pay_item_rate and i1.PAY_PERIOD_ENDDATE=i2.PAY_PERIOD_ENDDATE&#xA;group by i1.id_number,i1.position_code&#xA;&#xA;) as f4 on f2.id_number=f4.ID_NUMBER  &#xA;and f3.position_code=f4.POSITION_CODE&#x9;COLLATE DATABASE_DEFAULT &#xA;where f1. Hourly_Rate is null &#xA;&#xA;&#xA;&#xA;--case4: no pay records when @v_date and move to next pay_period.&#xA;update f1&#xA;set f1.Hourly_Rate=f4.pay_item_rate&#xA;from  conform_finance.lsl_fact as f1&#xA;inner join    conform_finance.employee_dim as f2 on f1.employee_key =f2.employee_key and f2.current_row_indicator='Y'&#xA;inner join    conform_finance.position_dim as f3 on f1.primary_position_key =f3.position_key and f3.current_row_indicator='Y'&#xA;inner join&#xA;(&#xA;&#xA;select&#xA;&#x9;i1.id_number,i1.position_code,max(i1.pay_item_rate) as pay_item_rate &#xA;from &#xA;(&#xA;select id_number,PAY_PERIOD_ENDDATE,pay_item_rate,POSITION_CODE&#xA;from extract.HRPAY_PAYITEMS_DTL&#x9; &#xA;where PAY_COMPONENT_DEF =100 and  pay_component_ref =&#x9; 100&#xA;--and PAY_PERIOD_ENDDATE&gt;='2016-11-21 00:00:00.000'&#xA;and PAY_PERIOD_ENDDATE&lt;=DATEADD(day,56,@v_date)&#xA;) as i1&#xA;inner join&#xA;(&#xA;select g1.id_number,g1.pay_item_rate,g1.POSITION_CODE,max(g1.PAY_PERIOD_ENDDATE) as PAY_PERIOD_ENDDATE&#xA;from &#xA;(&#xA;select id_number,PAY_PERIOD_ENDDATE,pay_item_rate,POSITION_CODE&#xA;from extract.HRPAY_PAYITEMS_DTL&#x9; &#xA;where PAY_COMPONENT_DEF =100 and  pay_component_ref =&#x9; 100&#xA;--and PAY_PERIOD_ENDDATE&gt;='2016-11-21 00:00:00.000'&#xA;and PAY_PERIOD_ENDDATE&lt;=DATEADD(day,56,@v_date)&#xA;) as g1&#xA;group by   g1.id_number,g1.pay_item_rate,g1.POSITION_CODE&#xA; ) as i2&#xA; on i1.id_number=i2.id_number and i1.POSITION_CODE=i2.POSITION_CODE and i1.pay_item_rate=i2.pay_item_rate and i1.PAY_PERIOD_ENDDATE=i2.PAY_PERIOD_ENDDATE&#xA;group by i1.id_number,i1.position_code&#xA;&#xA;) as f4 on f2.id_number=f4.ID_NUMBER  &#xA;and f3.position_code=f4.POSITION_CODE&#x9;COLLATE DATABASE_DEFAULT &#xA;where f1. Hourly_Rate is null &#xA;-----------------------------------------------------------------------------------------------------------------------------------------------&#xA;-- Liability&#xA;update &#x9; conform_finance.lsl_fact &#xA;set Liability= hours * Hourly_Rate&#xA;&#xA;-- Probability %&#xA; --update &#x9; conform_finance.lsl_fact &#xA; --set Probability=@v_Probability;&#xA;&#xA;   update &#x9; conform_finance.lsl_fact &#xA;&#x9;&#x9;&#x9;&#x9; set Probability=&#xA;&#x9;&#x9;&#x9;&#x9;  case Years_Rounded_Down&#xA;&#x9;&#x9;&#x9;&#x9;  when 6 then &#x9;0.87&#xA;&#x9;&#x9;&#x9;&#x9;  when 5 then &#x9;0.5&#xA;&#x9;&#x9;&#x9;      when 4 then &#x9;0.12&#xA;&#x9;&#x9;&#x9;      when 3 then &#x9;0.12&#xA;&#x9;&#x9;&#x9;      when 2 then &#x9;0.12&#xA;&#x9;&#x9;&#x9;&#x9;  when 1 then &#x9;0.12&#xA;&#x9;&#x9;&#x9;&#x9;  when 0 then 0.12&#xA;&#x9;&#x9;     &#x9;  else 1&#xA;&#x9;&#x9;&#x9;&#x9;  end;&#xA;&#xA;-- Revised Liability based on probability&#xA;   update &#x9; conform_finance.lsl_fact &#xA;   set Revised_Liability_based_on_probability= Liability* Probability;&#xA;&#xA;&#xA;--Liability at Entitlement Wages growth 2% until entitlement)&#xA;update &#x9; conform_finance.lsl_fact &#xA;   set Liability_at_Entitlement_Wagesgrowth = &#xA;     case Years_Rounded_Down&#xA;&#x9; when 6  then   Revised_Liability_based_on_probability * 1.02  &#xA;&#x9; when 5  then   Revised_Liability_based_on_probability * 1.0404&#xA;&#x9; when 4  then   Revised_Liability_based_on_probability * 1.061208&#xA;&#x9; when 3  then   Revised_Liability_based_on_probability * 1.08243216&#xA;     when 2  then   Revised_Liability_based_on_probability * 1.1040808032&#xA;&#x9; when 1  then   Revised_Liability_based_on_probability * 1.126162419264&#xA;&#x9; else Revised_Liability_based_on_probability&#xA;&#x9; end;&#xA;&#xA;---NPV_of_Liability&#xA; update &#x9; conform_finance.lsl_fact &#xA;   set NPV_of_Liability = &#xA;     case &#xA;&#x9; when Years_Rounded_Down &gt; 6 then  Revised_Liability_based_on_probability&#xA;&#x9; else &#xA;&#x9; (&#xA;&#x9; case 7-Years_Rounded_Down&#xA;&#x9; when 6  then   Revised_Liability_based_on_probability * 0.814773&#xA;&#x9; when 5  then   Revised_Liability_based_on_probability * 0.851&#xA;&#x9; when 4  then   Revised_Liability_based_on_probability * 0.886307&#xA;&#x9; when 3  then   Revised_Liability_based_on_probability * 0.919727&#xA;     when 2  then   Revised_Liability_based_on_probability * 0.950204&#xA;&#x9; when 1  then   Revised_Liability_based_on_probability * 0.976959&#xA;&#x9; end&#xA;&#x9; )&#xA;&#x9; end;&#xA;&#xA;--@v_casual_factor&#xA;update  conform_finance.lsl_fact&#xA;set  Casual_Factor=@v_casual_factor&#x9;  ;&#xA;&#xA;--NPV after casual factor&#xA;update  conform_finance.lsl_fact&#xA;set  NPV_after_casual_factor=NPV_of_Liability * (@v_casual_factor)&#x9;  ;&#xA;&#xA;&#xA;--Add Super @ 9.5%&#xA;update  conform_finance.lsl_fact&#xA;set  Add_Super=NPV_after_casual_factor * (@v_Super)&#x9;  ;&#xA;&#xA;&#xA;--Ave WC Rate&#xA;update  conform_finance.lsl_fact&#xA;set  Ave_WC_Rate=(NPV_after_casual_factor + Add_Super ) * (@v_Ave_WC_Rate)&#x9;  ;&#xA;&#xA;--LY Ave Workcover rate&#xA;update  conform_finance.lsl_fact&#xA;set  LY_Ave_Workcover_rate=(NPV_after_casual_factor + Add_Super ) * (@v_LY_Ave_Workcover_rate)&#x9;  ;&#xA;&#xA;&#xA;--&#x9;2016/2017 WorkCover %&#xA;update f1&#xA;set f1.WorkCover_20162017=convert(decimal(14,6),f4.units) /100&#xA;from  conform_finance.lsl_fact as f1&#xA;inner join    conform_finance.employee_dim as f2 on f1.employee_key =f2.employee_key and f2.current_row_indicator='Y'&#xA;inner join    conform_finance.position_dim as f3 on f1.primary_position_key =f3.position_key and f3.current_row_indicator='Y'&#xA;inner join&#x9;  extract.employee_workcover_rate as f4 on f2.Id_Number =rtrim(f4.Id_Number) and f3.position_code=rtrim(f4.position_code) and f4.active_indicator='Y';&#xA;&#xA; --fix some null workcover&#xA; --some employee has no data in T1 export file.&#xA;update f1&#xA;set f1.WorkCover_20162017=convert(decimal(14,6),f4.units) /100&#xA;from  conform_finance.lsl_fact as f1&#xA;inner join    conform_finance.employee_dim as f2 on f1.employee_key =f2.employee_key and f2.current_row_indicator='Y'&#xA;--inner join    conform_finance.position_dim as f3 on f1.primary_position_key =f3.position_key and f3.current_row_indicator='Y'&#xA;inner join&#x9;  extract.employee_workcover_rate as f4 on f2.Id_Number =rtrim(f4.Id_Number) and f4.active_indicator='Y'&#xA;where f1.WorkCover_20162017 is null&#xA;&#xA;&#xA;--Add Workcover&#xA;update t1&#xA;set&#x9;t1.Add_Workcover= (t1.NPV_after_casual_factor + t1.Add_Super ) * &#x9; t1.WorkCover_20162017&#xA;from   conform_finance.lsl_fact as t1&#x9; ;&#xA;&#xA;&#xA;--delete employee whose service_date is later than calculation date&#xA;delete from  conform_finance.lsl_fact&#xA;where Years_of_Completed_Service_asat_calculateday&lt;0&#xA;&#xA;&#xA;&#xA;end;&#xA;&#xA;&#xA;&#xA;&#xA;" xmlns:SQLTask="www.microsoft.com/sqlserver/dts/tasks/sqltask" />
              </DTS:ObjectData>
            </DTS:Executable>
            <DTS:Executable
              DTS:refId="Package\Sequence Container - Fact Tables\SD1 - LSL_FACT\Truncate table"
              DTS:CreationName="Microsoft.ExecuteSQLTask"
              DTS:Description="Execute SQL Task"
              DTS:Disabled="True"
              DTS:DTSID="{77eeaf71-86f2-4bcc-9a1a-8dd11c4e8a55}"
              DTS:ExecutableType="Microsoft.ExecuteSQLTask"
              DTS:LocaleID="-1"
              DTS:ObjectName="Truncate table"
              DTS:ThreadHint="0">
              <DTS:Variables />
              <DTS:ObjectData>
                <SQLTask:SqlTaskData
                  SQLTask:Connection="{6B844CC6-0F5A-4327-899C-E5FE6584670F}"
                  SQLTask:SqlStatementSource=" truncate table  dwhf_finance.finance.kpi_fact;" xmlns:SQLTask="www.microsoft.com/sqlserver/dts/tasks/sqltask" />
              </DTS:ObjectData>
            </DTS:Executable>
          </DTS:Executables>
          <DTS:PrecedenceConstraints>
            <DTS:PrecedenceConstraint
              DTS:refId="Package\Sequence Container - Fact Tables\SD1 - LSL_FACT.PrecedenceConstraints[Constraint]"
              DTS:CreationName=""
              DTS:DTSID="{b1dc7cea-aec2-4509-a8e6-026e968b384c}"
              DTS:From="Package\Sequence Container - Fact Tables\SD1 - LSL_FACT\EST - Write Job Start info"
              DTS:LogicalAnd="True"
              DTS:ObjectName="Constraint"
              DTS:To="Package\Sequence Container - Fact Tables\SD1 - LSL_FACT\Truncate table" />
            <DTS:PrecedenceConstraint
              DTS:refId="Package\Sequence Container - Fact Tables\SD1 - LSL_FACT.PrecedenceConstraints[Constraint 1]"
              DTS:CreationName=""
              DTS:DTSID="{7a2cb6e0-c7af-4273-a76f-7a2ada6a9e4f}"
              DTS:From="Package\Sequence Container - Fact Tables\SD1 - LSL_FACT\Truncate table"
              DTS:LogicalAnd="True"
              DTS:ObjectName="Constraint 1"
              DTS:To="Package\Sequence Container - Fact Tables\SD1 - LSL_FACT\Get new records and update columns" />
            <DTS:PrecedenceConstraint
              DTS:refId="Package\Sequence Container - Fact Tables\SD1 - LSL_FACT.PrecedenceConstraints[Constraint 2]"
              DTS:CreationName=""
              DTS:DTSID="{d4c2051f-8f9f-4bec-853e-bc06be3c4d6e}"
              DTS:From="Package\Sequence Container - Fact Tables\SD1 - LSL_FACT\Get new records and update columns"
              DTS:LogicalAnd="True"
              DTS:ObjectName="Constraint 2"
              DTS:To="Package\Sequence Container - Fact Tables\SD1 - LSL_FACT\EST - Write Job Finish info" />
          </DTS:PrecedenceConstraints>
          <DTS:EventHandlers>
            <DTS:EventHandler
              DTS:refId="Package\Sequence Container - Fact Tables\SD1 - LSL_FACT.EventHandlers[OnError]"
              DTS:CreationName="OnError"
              DTS:DTSID="{f003c5e1-537b-48b7-ae40-b80e37b6b1f0}"
              DTS:EventID="244"
              DTS:EventName="OnError"
              DTS:LocaleID="-1">
              <DTS:Variables>
                <DTS:Variable
                  DTS:CreationName=""
                  DTS:Description="The propagate property of the event"
                  DTS:DTSID="{f7c3766e-2d48-4361-b5c9-9c5fb3ba1eef}"
                  DTS:IncludeInDebugDump="6789"
                  DTS:Namespace="System"
                  DTS:ObjectName="Propagate">
                  <DTS:VariableValue
                    DTS:DataType="11">-1</DTS:VariableValue>
                </DTS:Variable>
              </DTS:Variables>
              <DTS:Executables>
                <DTS:Executable
                  DTS:refId="Package\Sequence Container - Fact Tables\SD1 - LSL_FACT.EventHandlers[OnError]\Execute SQL Task - Catch Error Details"
                  DTS:CreationName="Microsoft.ExecuteSQLTask"
                  DTS:Description="Execute SQL Task"
                  DTS:DTSID="{85021bd8-4b57-4618-9d32-dae2c13d88cc}"
                  DTS:ExecutableType="Microsoft.ExecuteSQLTask"
                  DTS:LocaleID="-1"
                  DTS:ObjectName="Execute SQL Task - Catch Error Details">
                  <DTS:Variables />
                  <DTS:ObjectData>
                    <SQLTask:SqlTaskData
                      SQLTask:Connection="{6B844CC6-0F5A-4327-899C-E5FE6584670F}"
                      SQLTask:SqlStatementSource="-- insert into management.ERROR_EVENT_DETAIL_FACT table&#xA;&#xA;insert into management.ERROR_EVENT_DETAIL_FACT&#xA;SELECT &#xA;(SELECT DATE_KEY FROM management.DATE_DIM WHERE CONVERT(DATE,FULL_DATE)=CONVERT(DATE,GETDATE()) )&#xA;,(SELECT batch_key FROM management.BATCH_DIM WHERE BATCH_TYPE='batch') &#xA;,T2.TABLE_KEY&#xA;,T2.TABLE_KEY&#xA;,?&#xA;,' '&#xA;,4&#xA;FROM  management.TABLE_DIM T2&#xA;WHERE T2.[SCHEMA]+'.'+T2.TABLE_NAME='conform.employee_termination_fact'&#xA;&#xA;&#xA;-- insert into [management].ETL_PROCESS_FACT with 'Failed'&#xA;INSERT INTO [management].ETL_PROCESS_FACT&#xA;SELECT  &#xA;(SELECT DATE_KEY FROM management.DATE_DIM WHERE CONVERT(DATE,FULL_DATE)=CONVERT(DATE,GETDATE()) )&#xA;,(SELECT batch_key FROM management.BATCH_DIM WHERE BATCH_TYPE='batch')&#xA;, T2.TABLE_KEY&#xA;,3&#xA;,GETDATE() &#xA;,4&#xA;,'Update Fact Table'    &#xA;FROM  management.TABLE_DIM T2&#xA;WHERE T2.[SCHEMA]+'.'+T2.TABLE_NAME='conform.employee_termination_fact'&#xA;&#xA; -- insert into management.ERROR_EVENT_FACT table&#xA;insert into management.ERROR_EVENT_FACT&#xA;SELECT &#xA;(SELECT batch_key FROM management.BATCH_DIM WHERE BATCH_TYPE='batch') &#xA;,(SELECT DATE_KEY FROM management.DATE_DIM WHERE CONVERT(DATE,FULL_DATE)=CONVERT(DATE,GETDATE()) )&#xA;,convert(varchar, getdate(),21)&#xA;, 'HIGH'&#xA;,4&#xA;FROM  management.TABLE_DIM T2&#xA;WHERE T2.[SCHEMA]+'.'+T2.TABLE_NAME='conform.employee_termination_fact'&#xA;&#xA;" xmlns:SQLTask="www.microsoft.com/sqlserver/dts/tasks/sqltask">
                      <SQLTask:ParameterBinding
                        SQLTask:ParameterName="0"
                        SQLTask:DtsVariableName="System::ErrorDescription"
                        SQLTask:ParameterDirection="Input"
                        SQLTask:DataType="130"
                        SQLTask:ParameterSize="-1" />
                    </SQLTask:SqlTaskData>
                  </DTS:ObjectData>
                </DTS:Executable>
              </DTS:Executables>
            </DTS:EventHandler>
          </DTS:EventHandlers>
        </DTS:Executable>
      </DTS:Executables>
      <DTS:PrecedenceConstraints>
        <DTS:PrecedenceConstraint
          DTS:refId="Package\Sequence Container - Fact Tables.PrecedenceConstraints[Constraint]"
          DTS:CreationName=""
          DTS:DTSID="{07D11B70-D506-47B9-BB1A-302393AE2DCF}"
          DTS:From="Package\Sequence Container - Fact Tables\SD1 - DEBTOR_FACT"
          DTS:LogicalAnd="True"
          DTS:ObjectName="Constraint"
          DTS:To="Package\Sequence Container - Fact Tables\SD1 - KPI_FACT"
          DTS:Value="2" />
        <DTS:PrecedenceConstraint
          DTS:refId="Package\Sequence Container - Fact Tables.PrecedenceConstraints[Constraint 1]"
          DTS:CreationName=""
          DTS:DTSID="{1DA28F66-10CF-4A2E-8F98-C071CF98A12B}"
          DTS:From="Package\Sequence Container - Fact Tables\SD1 - KPI_FACT"
          DTS:LogicalAnd="True"
          DTS:ObjectName="Constraint 1"
          DTS:To="Package\Sequence Container - Fact Tables\SD1 - LSL_FACT"
          DTS:Value="2" />
      </DTS:PrecedenceConstraints>
    </DTS:Executable>
  </DTS:Executables>
  <DTS:EventHandlers>
    <DTS:EventHandler
      DTS:refId="Package.EventHandlers[OnError]"
      DTS:CreationName="OnError"
      DTS:DTSID="{4C7BF364-E443-4B98-BC53-E76B1EED6C7A}"
      DTS:EventID="1701257339"
      DTS:EventName="OnError"
      DTS:LocaleID="-1">
      <DTS:Variables>
        <DTS:Variable
          DTS:CreationName=""
          DTS:Description="The propagate property of the event"
          DTS:DTSID="{2D797829-03FA-4575-A3EE-46AABB4CBEAF}"
          DTS:IncludeInDebugDump="6789"
          DTS:Namespace="System"
          DTS:ObjectName="Propagate">
          <DTS:VariableValue
            DTS:DataType="11">-1</DTS:VariableValue>
        </DTS:Variable>
      </DTS:Variables>
      <DTS:Executables />
    </DTS:EventHandler>
  </DTS:EventHandlers>
  <DTS:DesignTimeProperties><![CDATA[<?xml version="1.0"?>
<!--This CDATA section contains the layout information of the package. The section includes information such as (x,y) coordinates, width, and height.-->
<!--If you manually edit this section and make a mistake, you can delete it. -->
<!--The package will still be able to load normally but the previous layout information will be lost and the designer will automatically re-arrange the elements on the design surface.-->
<Objects
  Version="8">
  <!--Each node below will contain properties that do not affect runtime behavior.-->
  <Package
    design-time-name="Package">
    <LayoutInfo>
      <GraphLayout
        Capacity="32" xmlns="clr-namespace:Microsoft.SqlServer.IntegrationServices.Designer.Model.Serialization;assembly=Microsoft.SqlServer.IntegrationServices.Graph" xmlns:mssgle="clr-namespace:Microsoft.SqlServer.Graph.LayoutEngine;assembly=Microsoft.SqlServer.Graph" xmlns:assembly="http://schemas.microsoft.com/winfx/2006/xaml" xmlns:mssgm="clr-namespace:Microsoft.SqlServer.Graph.Model;assembly=Microsoft.SqlServer.Graph">
        <NodeLayout
          Size="222,42"
          Id="Package\Sequence Container - Fact Tables\SD1 - DEBTOR_FACT\EST - Write Job Finish info"
          TopLeft="35.15,273" />
        <NodeLayout
          Size="222,42"
          Id="Package\Sequence Container - Fact Tables\SD1 - DEBTOR_FACT\EST - Write Job Start info"
          TopLeft="35.15,28" />
        <NodeLayout
          Size="222,42"
          Id="Package\Sequence Container - Fact Tables\SD1 - DEBTOR_FACT\Get new records and update columns"
          TopLeft="35.15,191" />
        <NodeLayout
          Size="212,42"
          Id="Package\Sequence Container - Fact Tables\SD1 - DEBTOR_FACT\Truncate table"
          TopLeft="39.15,101" />
        <EdgeLayout
          Id="Package\Sequence Container - Fact Tables\SD1 - DEBTOR_FACT.PrecedenceConstraints[Constraint]"
          TopLeft="145.65,70">
          <EdgeLayout.Curve>
            <mssgle:Curve
              StartConnector="{assembly:Null}"
              EndConnector="0,31"
              Start="0,0"
              End="0,23.5">
              <mssgle:Curve.Segments>
                <mssgle:SegmentCollection
                  Capacity="5">
                  <mssgle:LineSegment
                    End="0,23.5" />
                </mssgle:SegmentCollection>
              </mssgle:Curve.Segments>
            </mssgle:Curve>
          </EdgeLayout.Curve>
          <EdgeLayout.Labels>
            <EdgeLabelCollection />
          </EdgeLayout.Labels>
        </EdgeLayout>
        <EdgeLayout
          Id="Package\Sequence Container - Fact Tables\SD1 - DEBTOR_FACT.PrecedenceConstraints[Constraint 1]"
          TopLeft="145.65,143">
          <EdgeLayout.Curve>
            <mssgle:Curve
              StartConnector="{assembly:Null}"
              EndConnector="0,48"
              Start="0,0"
              End="0,40.5">
              <mssgle:Curve.Segments>
                <mssgle:SegmentCollection
                  Capacity="5">
                  <mssgle:LineSegment
                    End="0,40.5" />
                </mssgle:SegmentCollection>
              </mssgle:Curve.Segments>
            </mssgle:Curve>
          </EdgeLayout.Curve>
          <EdgeLayout.Labels>
            <EdgeLabelCollection />
          </EdgeLayout.Labels>
        </EdgeLayout>
        <EdgeLayout
          Id="Package\Sequence Container - Fact Tables\SD1 - DEBTOR_FACT.PrecedenceConstraints[Constraint 2]"
          TopLeft="146.15,233">
          <EdgeLayout.Curve>
            <mssgle:Curve
              StartConnector="{assembly:Null}"
              EndConnector="0,40"
              Start="0,0"
              End="0,32.5">
              <mssgle:Curve.Segments>
                <mssgle:SegmentCollection
                  Capacity="5">
                  <mssgle:LineSegment
                    End="0,32.5" />
                </mssgle:SegmentCollection>
              </mssgle:Curve.Segments>
            </mssgle:Curve>
          </EdgeLayout.Curve>
          <EdgeLayout.Labels>
            <EdgeLabelCollection />
          </EdgeLayout.Labels>
        </EdgeLayout>
        <ContainerLayout
          HeaderHeight="43"
          IsExpanded="True"
          PanelSize="345,370"
          Size="345,413"
          Id="Package\Sequence Container - Fact Tables\SD1 - DEBTOR_FACT"
          TopLeft="5.5,5.49999999999989" />
        <NodeLayout
          Size="222,42"
          Id="Package\Sequence Container - Fact Tables\SD1 - KPI_FACT\EST - Write Job Finish info"
          TopLeft="35.15,273" />
        <NodeLayout
          Size="222,42"
          Id="Package\Sequence Container - Fact Tables\SD1 - KPI_FACT\EST - Write Job Start info"
          TopLeft="35.15,28" />
        <NodeLayout
          Size="222,42"
          Id="Package\Sequence Container - Fact Tables\SD1 - KPI_FACT\Get new records and update columns"
          TopLeft="35.15,191" />
        <NodeLayout
          Size="212,42"
          Id="Package\Sequence Container - Fact Tables\SD1 - KPI_FACT\Truncate table"
          TopLeft="39.15,101" />
        <EdgeLayout
          Id="Package\Sequence Container - Fact Tables\SD1 - KPI_FACT.PrecedenceConstraints[Constraint]"
          TopLeft="145.65,70">
          <EdgeLayout.Curve>
            <mssgle:Curve
              StartConnector="{assembly:Null}"
              EndConnector="0,31"
              Start="0,0"
              End="0,23.5">
              <mssgle:Curve.Segments>
                <mssgle:SegmentCollection
                  Capacity="5">
                  <mssgle:LineSegment
                    End="0,23.5" />
                </mssgle:SegmentCollection>
              </mssgle:Curve.Segments>
            </mssgle:Curve>
          </EdgeLayout.Curve>
          <EdgeLayout.Labels>
            <EdgeLabelCollection />
          </EdgeLayout.Labels>
        </EdgeLayout>
        <EdgeLayout
          Id="Package\Sequence Container - Fact Tables\SD1 - KPI_FACT.PrecedenceConstraints[Constraint 1]"
          TopLeft="145.65,143">
          <EdgeLayout.Curve>
            <mssgle:Curve
              StartConnector="{assembly:Null}"
              EndConnector="0,48"
              Start="0,0"
              End="0,40.5">
              <mssgle:Curve.Segments>
                <mssgle:SegmentCollection
                  Capacity="5">
                  <mssgle:LineSegment
                    End="0,40.5" />
                </mssgle:SegmentCollection>
              </mssgle:Curve.Segments>
            </mssgle:Curve>
          </EdgeLayout.Curve>
          <EdgeLayout.Labels>
            <EdgeLabelCollection />
          </EdgeLayout.Labels>
        </EdgeLayout>
        <EdgeLayout
          Id="Package\Sequence Container - Fact Tables\SD1 - KPI_FACT.PrecedenceConstraints[Constraint 2]"
          TopLeft="146.15,233">
          <EdgeLayout.Curve>
            <mssgle:Curve
              StartConnector="{assembly:Null}"
              EndConnector="0,40"
              Start="0,0"
              End="0,32.5">
              <mssgle:Curve.Segments>
                <mssgle:SegmentCollection
                  Capacity="5">
                  <mssgle:LineSegment
                    End="0,32.5" />
                </mssgle:SegmentCollection>
              </mssgle:Curve.Segments>
            </mssgle:Curve>
          </EdgeLayout.Curve>
          <EdgeLayout.Labels>
            <EdgeLabelCollection />
          </EdgeLayout.Labels>
        </EdgeLayout>
        <ContainerLayout
          HeaderHeight="43"
          IsExpanded="True"
          PanelSize="345,370"
          Size="345,413"
          Id="Package\Sequence Container - Fact Tables\SD1 - KPI_FACT"
          TopLeft="411.5,5.49999999999989" />
        <NodeLayout
          Size="222,42"
          Id="Package\Sequence Container - Fact Tables\SD1 - LSL_FACT\EST - Write Job Finish info"
          TopLeft="35.15,273" />
        <NodeLayout
          Size="222,42"
          Id="Package\Sequence Container - Fact Tables\SD1 - LSL_FACT\EST - Write Job Start info"
          TopLeft="35.15,28" />
        <NodeLayout
          Size="257,42"
          Id="Package\Sequence Container - Fact Tables\SD1 - LSL_FACT\Get new records and update columns"
          TopLeft="35.15,191" />
        <NodeLayout
          Size="212,42"
          Id="Package\Sequence Container - Fact Tables\SD1 - LSL_FACT\Truncate table"
          TopLeft="39.15,101" />
        <EdgeLayout
          Id="Package\Sequence Container - Fact Tables\SD1 - LSL_FACT.PrecedenceConstraints[Constraint]"
          TopLeft="145.65,70">
          <EdgeLayout.Curve>
            <mssgle:Curve
              StartConnector="{assembly:Null}"
              EndConnector="0,31"
              Start="0,0"
              End="0,23.5">
              <mssgle:Curve.Segments>
                <mssgle:SegmentCollection
                  Capacity="5">
                  <mssgle:LineSegment
                    End="0,23.5" />
                </mssgle:SegmentCollection>
              </mssgle:Curve.Segments>
            </mssgle:Curve>
          </EdgeLayout.Curve>
          <EdgeLayout.Labels>
            <EdgeLabelCollection />
          </EdgeLayout.Labels>
        </EdgeLayout>
        <EdgeLayout
          Id="Package\Sequence Container - Fact Tables\SD1 - LSL_FACT.PrecedenceConstraints[Constraint 1]"
          TopLeft="145.15,143">
          <EdgeLayout.Curve>
            <mssgle:Curve
              StartConnector="{assembly:Null}"
              EndConnector="18.5,48"
              Start="0,0"
              End="18.5,40.5">
              <mssgle:Curve.Segments>
                <mssgle:SegmentCollection
                  Capacity="5">
                  <mssgle:LineSegment
                    End="0,20" />
                  <mssgle:CubicBezierSegment
                    Point1="0,20"
                    Point2="0,24"
                    Point3="4,24" />
                  <mssgle:LineSegment
                    End="14.5,24" />
                  <mssgle:CubicBezierSegment
                    Point1="14.5,24"
                    Point2="18.5,24"
                    Point3="18.5,28" />
                  <mssgle:LineSegment
                    End="18.5,40.5" />
                </mssgle:SegmentCollection>
              </mssgle:Curve.Segments>
            </mssgle:Curve>
          </EdgeLayout.Curve>
          <EdgeLayout.Labels>
            <EdgeLabelCollection />
          </EdgeLayout.Labels>
        </EdgeLayout>
        <EdgeLayout
          Id="Package\Sequence Container - Fact Tables\SD1 - LSL_FACT.PrecedenceConstraints[Constraint 2]"
          TopLeft="163.65,233">
          <EdgeLayout.Curve>
            <mssgle:Curve
              StartConnector="{assembly:Null}"
              EndConnector="-17.5,40"
              Start="0,0"
              End="-17.5,32.5">
              <mssgle:Curve.Segments>
                <mssgle:SegmentCollection
                  Capacity="5">
                  <mssgle:LineSegment
                    End="0,16" />
                  <mssgle:CubicBezierSegment
                    Point1="0,16"
                    Point2="0,20"
                    Point3="-4,20" />
                  <mssgle:LineSegment
                    End="-13.5,20" />
                  <mssgle:CubicBezierSegment
                    Point1="-13.5,20"
                    Point2="-17.5,20"
                    Point3="-17.5,24" />
                  <mssgle:LineSegment
                    End="-17.5,32.5" />
                </mssgle:SegmentCollection>
              </mssgle:Curve.Segments>
            </mssgle:Curve>
          </EdgeLayout.Curve>
          <EdgeLayout.Labels>
            <EdgeLabelCollection />
          </EdgeLayout.Labels>
        </EdgeLayout>
        <ContainerLayout
          HeaderHeight="43"
          IsExpanded="True"
          PanelSize="345,370"
          Size="345,413"
          Id="Package\Sequence Container - Fact Tables\SD1 - LSL_FACT"
          TopLeft="816.5,5.49999999999989" />
        <EdgeLayout
          Id="Package\Sequence Container - Fact Tables.PrecedenceConstraints[Constraint]"
          TopLeft="350.5,212">
          <EdgeLayout.Curve>
            <mssgle:Curve
              StartConnector="{assembly:Null}"
              EndConnector="61,0"
              Start="0,0"
              End="53.5,0">
              <mssgle:Curve.Segments>
                <mssgle:SegmentCollection
                  Capacity="5">
                  <mssgle:LineSegment
                    End="53.5,0" />
                </mssgle:SegmentCollection>
              </mssgle:Curve.Segments>
            </mssgle:Curve>
          </EdgeLayout.Curve>
          <EdgeLayout.Labels>
            <mssgm:EdgeLabel
              BoundingBox="1.445546875,5,50.60890625,11.609375"
              RelativePosition="Any" />
          </EdgeLayout.Labels>
        </EdgeLayout>
        <EdgeLayout
          Id="Package\Sequence Container - Fact Tables.PrecedenceConstraints[Constraint 1]"
          TopLeft="756.5,212">
          <EdgeLayout.Curve>
            <mssgle:Curve
              StartConnector="{assembly:Null}"
              EndConnector="60,0"
              Start="0,0"
              End="52.5,0">
              <mssgle:Curve.Segments>
                <mssgle:SegmentCollection
                  Capacity="5">
                  <mssgle:LineSegment
                    End="52.5,0" />
                </mssgle:SegmentCollection>
              </mssgle:Curve.Segments>
            </mssgle:Curve>
          </EdgeLayout.Curve>
          <EdgeLayout.Labels>
            <mssgm:EdgeLabel
              BoundingBox="0.945546874999998,5,50.60890625,11.609375"
              RelativePosition="Any" />
          </EdgeLayout.Labels>
        </EdgeLayout>
        <ContainerLayout
          HeaderHeight="43"
          IsExpanded="True"
          PanelSize="1255,473"
          Size="1255,516"
          Id="Package\Sequence Container - Fact Tables"
          TopLeft="31.833333333333,1.99999999999818" />
      </GraphLayout>
    </LayoutInfo>
  </Package>
  <DtsEventHandler
    design-time-name="Package\Sequence Container - Fact Tables\SD1 - DEBTOR_FACT.EventHandlers[OnError]">
    <LayoutInfo>
      <GraphLayout
        Capacity="4" xmlns="clr-namespace:Microsoft.SqlServer.IntegrationServices.Designer.Model.Serialization;assembly=Microsoft.SqlServer.IntegrationServices.Graph">
        <NodeLayout
          Size="264,42"
          Id="Package\Sequence Container - Fact Tables\SD1 - DEBTOR_FACT.EventHandlers[OnError]\Execute SQL Task - Catch Error Details"
          TopLeft="448,222" />
      </GraphLayout>
    </LayoutInfo>
  </DtsEventHandler>
  <DtsEventHandler
    design-time-name="Package\Sequence Container - Fact Tables\SD1 - KPI_FACT.EventHandlers[OnError]">
    <LayoutInfo>
      <GraphLayout
        Capacity="4" xmlns="clr-namespace:Microsoft.SqlServer.IntegrationServices.Designer.Model.Serialization;assembly=Microsoft.SqlServer.IntegrationServices.Graph">
        <NodeLayout
          Size="264,42"
          Id="Package\Sequence Container - Fact Tables\SD1 - KPI_FACT.EventHandlers[OnError]\Execute SQL Task - Catch Error Details"
          TopLeft="448,222" />
      </GraphLayout>
    </LayoutInfo>
  </DtsEventHandler>
  <DtsEventHandler
    design-time-name="Package\Sequence Container - Fact Tables\SD1 - LSL_FACT.EventHandlers[OnError]">
    <LayoutInfo>
      <GraphLayout
        Capacity="4" xmlns="clr-namespace:Microsoft.SqlServer.IntegrationServices.Designer.Model.Serialization;assembly=Microsoft.SqlServer.IntegrationServices.Graph">
        <NodeLayout
          Size="264,42"
          Id="Package\Sequence Container - Fact Tables\SD1 - LSL_FACT.EventHandlers[OnError]\Execute SQL Task - Catch Error Details"
          TopLeft="448,222" />
      </GraphLayout>
    </LayoutInfo>
  </DtsEventHandler>
</Objects>]]></DTS:DesignTimeProperties>
</DTS:Executable>